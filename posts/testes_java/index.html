<!doctype html><html lang=pt dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[WIP] Testes em Java - JUnit, Mockito, Integração e TestContainers | Kaue Gatto</title><meta name=keywords content="JAVA,SPRING,TESTES"><meta name=description content="Vamos explorar como fazer testes em java!"><meta name=author content="Me"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://user-images.githubusercontent.com/25181517/192107856-aa92c8b1-b615-47c3-9141-ed0d29a90239.png><link rel=icon type=image/png sizes=16x16 href=https://user-images.githubusercontent.com/25181517/192107856-aa92c8b1-b615-47c3-9141-ed0d29a90239.png><link rel=icon type=image/png sizes=32x32 href=https://user-images.githubusercontent.com/25181517/192107856-aa92c8b1-b615-47c3-9141-ed0d29a90239.png><link rel=apple-touch-icon href=https://user-images.githubusercontent.com/25181517/192107856-aa92c8b1-b615-47c3-9141-ed0d29a90239.png><link rel=mask-icon href=https://user-images.githubusercontent.com/25181517/192107856-aa92c8b1-b615-47c3-9141-ed0d29a90239.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=pt href=https://kaue.cat/posts/testes_java/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-6MZTJBEG75"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6MZTJBEG75",{anonymize_ip:!1})}</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-6MZTJBEG75","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6MZTJBEG75"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6MZTJBEG75",{anonymize_ip:!1})}</script><meta property="og:title" content="[WIP] Testes em Java - JUnit, Mockito, Integração e TestContainers"><meta property="og:description" content="Vamos explorar como fazer testes em java!"><meta property="og:type" content="article"><meta property="og:url" content="https://kaue.cat/posts/testes_java/"><meta property="og:image" content="https://kaue.cat/%3Cimage%20path/url%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-03T16:30:03+00:00"><meta property="article:modified_time" content="2024-01-03T16:30:03+00:00"><meta property="og:site_name" content="Kaue Gatto - Blog de Desenvolvimento"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kaue.cat/%3Cimage%20path/url%3E"><meta name=twitter:title content="[WIP] Testes em Java - JUnit, Mockito, Integração e TestContainers"><meta name=twitter:description content="Vamos explorar como fazer testes em java!"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://kaue.cat/posts/"},{"@type":"ListItem","position":3,"name":"[WIP] Testes em Java - JUnit, Mockito, Integração e TestContainers","item":"https://kaue.cat/posts/testes_java/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[WIP] Testes em Java - JUnit, Mockito, Integração e TestContainers","name":"[WIP] Testes em Java - JUnit, Mockito, Integração e TestContainers","description":"Vamos explorar como fazer testes em java!","keywords":["JAVA","SPRING","TESTES"],"articleBody":"Aviso - Algumas imagens estarão quebradas aqui, enquanto for um trabalho em progresso, recomendo a leitura aqui!\nSpring + Testing Configuração do Maven: Certifique-se de que o Maven esteja instalado em seu sistema. No arquivo pom.xml do seu projeto, adicione as dependências necessárias para JUnit e o suporte de testes do Spring Boot. Normalmente, essas dependências (normalmente spring-boot-starter-test) já estão incluídas no arquivo de modelo gerado pelo Spring Initializr ao criar um projeto Spring Boot. Estrutura de diretórios: No diretório do seu projeto, crie a estrutura de diretórios padrão para testes: src/test/java e src/test/resources. Os testes de unidade devem ser colocados no diretório src/test/java seguindo a mesma estrutura de pacotes do código-fonte principal. Criação de testes: Crie classes de teste, essas classes de teste são geralmente nomeadas de acordo com a classe que estão testando, seguidas por “Test”. Exemplo: UserService, →**UserServiceTest**.\nAnote a classe de teste com @RunWith(SpringRunner.class) para permitir a execução do teste no contexto do Spring Boot.\nAnote a classe de teste com @SpringBootTest para carregar o contexto do Spring Boot durante a execução do teste.\nInjete as dependências necessárias\nCrie métodos de teste usando a anotação @Test e implemente a lógica de teste dentro desses métodos.\nSe esse teste lançar uma exceção, defina a propriedade expected na annotation. JUnit - Testes de Unidade Testes de unidade são testes feitos para cobrir um comportamento ou unidade específica de execução dentro de um método. Seu método de iniciar conversação pode ter vários e-se, nesse caso, um teste de unidade seria criado para validar cada e-se Testes de unidade, de maneira geral são executados com a biblioteca JUnit, que será o foco desse capítulo. Para sua utilização, criamos um método que retorna void e é anotado por @Test, esse método deve conter operações e validações (assertions) para garantir o retorno esperado. import org.junit.Test; import static org.junit.Assert.assertEquals; public class CalculadoraTest { @Test @DisplayName(\"Testando soma\") public void testSoma() { // Arrange (preparação) Calculadora calculadora = new Calculadora(); // Act (ação) int resultado = calculadora.soma(2, 3); // Assert (verificação) assertEquals(5, resultado); } @Test public void testSubtracao() { // Arrange Calculadora calculadora = new Calculadora(); // Act int resultado = calculadora.subtracao(5, 2); // Assert assertEquals(3, resultado); } @Disabled(\"Esperando resolverem o bug que 3 é diferente de 1\") @Test public void testNaoSeiOq(){ assertEquals(3,1); } } Normalmente organizamos nossos testes de unidade em 3 etapas: given-when-then ou o triplo A: Arrange, Act \u0026 Assert Assertions // Padrão: assertEquals(2, calculadora.soma(1, 1)); assertEquals(4, calculadora.multiplica(2, 2), \"The optional failure message is now the last parameter\"); assertTrue('a' \u003c 'b'); // Exceptions Exception exception = assertThrows(Aritmetica.class, () -\u003e calculadora.divide(1, 0)); assertEquals(\"/ por zero\", exception.getMessage()); // opcional Existem também bibliotecas focadas em gerar assertions mais legíveis/fluentes, como AssertJ e Hamcrest, podemos usa-las em conjunto com JUnit:\nimport static org.assertj.core.api.Assertions.*; assertThat(frodo.getName()).isEqualTo(\"Frodo\"); assertThat(frodo).isNotEqualTo(sauron); assertThat(fellowshipOfTheRing).hasSize(9) .contains(frodo, sam) .doesNotContain(sauron); Testes Parametrizados Testes parametrizados permitem a execução do “mesmo teste”, mas com inputs diferentes, com bem mais facilidade do que criar testes separados:\nimport org.junit.Test; import org.junit.runner.RunWith; import java.util.Arrays; import java.util.Collection; import static org.junit.Assert.assertEquals; public class CalculadoraTest { @ParameterizedTest @CsvSource({\"2, 3, 5\", \"5, 2, 3\", \"0, 0, 0\", \"-1, 1, 0\"}) public void testSoma(int inputA, int inputB, int expectedResult) { // Arrange Calculadora calculadora = new Calculadora(); // Act int resultado = calculadora.soma(inputA, inputB); // Assert assertEquals(expectedResult, resultado); } } Note que passamos os valores usando @CsvSource, mas não é a única maneira\n@ValueSource Uma das maneiras mais simples de realizar testes parametrizados no JUnit 5 é usando a anotação @ValueSource. Esta anotação permite especificar um único vetor de valores literais para fornecer argumentos a um método de teste parametrizado.\nOs principais tipos são suportados**:** int, long, float, String, Class, etc:\njavaCopy code import org.junit.jupiter.params.ParameterizedTest; import org.junit.jupiter.params.provider.ValueSource; import static org.junit.jupiter.api.Assertions.assertTrue; public class ExemploTest { @ParameterizedTest @ValueSource(ints = {1, 2, 3}) void testComValueSource(int argumento) { assertTrue(argumento \u003e 0 \u0026\u0026 argumento \u003c 4); } } @NullSource, @EmptySource Para testes de fronteira, ou input ruins pode ser útil passar valores nulos ou empty para nossos testes parametrizados:\n@NullSource: Fornece um argumento nulo para o método de teste parametrizado anotado. Não pode ser usada para parâmetros que têm um tipo primitivo. @EmptySource: Fornece um argumento vazio para o teste parametrizado. Ela pode ser utilizada para parâmetros de tipos como java.lang.String, java.util.Collection, java.util.List, java.util.Set, java.util.Map, e arrays primitivos e de objetos. @NullAndEmptySource: Esta é uma anotação composta que combina as funcionalidades de @NullSource e @EmptySource. Se precisarmos fornecer vários tipos de strings em branco para um teste parametrizado, podemos usar @ValueSource da seguinte maneira:\n@ValueSource(strings = {\" \", \" \", \"\\t\", \"\\n\"}) Podemos combinar @NullSource, @EmptySource e @ValueSource:\n@ParameterizedTest @NullAndEmptySource @ValueSource(strings = {\" \", \" \", \"\\t\", \"\\n\"}) void testNullEmptyAndBlankStrings(String texto) { assertTrue(texto == null || texto.trim().isEmpty()); } @MethodSource A anotação @MethodSource permite referenciar métodos na própria classe de teste ou em classes externas. Esses métodos devem ser estáticos. Cada método deve gerar uma sequência de argumentos. No final das contas, teremos uma Stream, mas podemos enviar uma ArrayList, Arrays ou qualquer coisa que faça sentido e deixar o JUnit se virar 🙂.\nExemplo:\n@ParameterizedTest @MethodSource(\"stringProvider\") void testComMethodSource(String argument) { assertNotNull(argument); } static Stream\u003cString\u003e stringProvider() { return Stream.of(\"apple\", \"banana\"); } Se um método parametrizado tiver diversos parâmtros, você precisará retornar uma collection, stream ou array de instâncias de Arguments, ou um arrays de objetos:\n@ParameterizedTest @MethodSource(\"stringIntAndListProvider\") void testWithMultiArgMethodSource(String str, int num, List\u003cString\u003e list) { assertEquals(5, str.length()); assertTrue(num \u003e=1 \u0026\u0026 num \u003c=2); assertEquals(2, list.size()); } static Stream\u003cArguments\u003e stringIntAndListProvider() { return Stream.of( arguments(\"apple\", 1, Arrays.asList(\"a\", \"b\")), arguments(\"lemon\", 2, Arrays.asList(\"x\", \"y\")) ); } Podemos usar métodos estáticos de outras classes como MethodSource dessa forma:\n@MethodSource(\"example.StringsProviders#tinyStrings\") @CsvSource A anotação @CsvSource permite expressar listas de argumentos como valores separados por vírgulas. Cada string fornecida representa um registro CSV e resulta em uma invocação do teste parametrizado.\nO delimitador padrão é a vírgula, mas pode ser alterado.\nAs aspas simples são usadas como aspas reais, servem para indicar que aquilo dentro é um texto, mas isso também pode ser configurado.\nExample Input Resulting Argument List @CsvSource({ “apple, banana” }) “apple”, “banana” @CsvSource({ “apple, ’lemon, lime’” }) “apple”, “lemon, lime” @CsvSource({ “apple, ‘’” }) “apple”, \"\" @CsvSource({ “apple, \" }) “apple”, null @CsvSource(value = { “apple, banana, NIL” }, nullValues = “NIL”) “apple”, “banana”, null @CsvSource(value = { \" apple , banana” }, ignoreLeadingAndTrailingWhitespace = false) \" apple “, \" banana” Exemplo:\n@ParameterizedTest @CsvSource({ \"apple, 1\", \"banana, 2\", \"'lemon, lime', 0xF1\", \"strawberry, 700_000\" }) void testComCsvSource(String fruit, int rank) { assertNotNull(fruit); assertNotEquals(0, rank); } Talvez a magia do csv source, além da leitura, seja a possibilidade de implementar diversos testes via um arquivo csv localizado no sistema de arquivos local e/ou classpath\n@CsvFileSource(resources = \"/custom-csv.csv\")\nMocking Tanto em testes de integração quanto de unidade, percebemos que devemos travar alguns valores, ou seja, se estamos testando uma regra de negócio dentro de um service, gostaríamos que nosso repositório sempre estivesse correto, assumimos isso como verdade para que nosso teste de unidade seja realmente de unidade.\nNão indo muito longe, é fácil criar mocks usando a biblioteca mockito:\nimport static org.mockito.Mockito.*; // (4.10+) List mockedList = mock(); // em versões mais antigas: List mockedList = mock(List.class); // Com um objeto mockado, não recebemos exceptions: mockedList.add(\"one\"); mockedList.clear(); // Com um objeto mockado, sabemos tudo que aconteceu: verify(mockedList).add(\"one\"); verify(mockedList).clear(); import org.junit.jupiter.api.Test; import org.mockito.InjectMocks; import org.mockito.Mock; import org.mockito.MockitoAnnotations; import static org.mockito.Mockito.when; public class UserServiceTest { @Mock UserRepository repository; @InjectMocks UserService service; @BeforeEach void setUp() { MockitoAnnotations.initMocks(this); } @Test void test() { when(repository.findById(\"123\")).thenReturn(new User()); // mockado :) } } Configurando Comportamento: Utilize when() ou given() para especificar como o mock deve se comportar. Se as respostas padrão não atenderem, implemente sua própria lógica estendendo a interface Answer e atribua ao mock. spy() e @Spy: Utilize spy() para criar um spy, é quase que um mock parcial, que chama os métodos reais, mas ainda pode ser verificado e manipulado. @InjectMocks: Anote a classe de teste com @InjectMocks para a injeção automática de mocks e spies anotados com @Mock ou @Spy. verify(): Use verify() para verificar se os métodos foram chamados com os argumentos esperados. Você pode ser mais flexível usando coisas como any(). Testando Repositórios (De verdade!) Podemos testar repositórios de alguns jeitos, uma das maneiras é utilizar um banco em memória. Para SQL, h2 é fácil e rápido, podemos fazer as configs no banco usando um application-properties para os testes e validar tudo bonitinho normalmente 🙂. Outra alternativa seria utilizar TestContainers TestContainers “Testcontainers é um framework de código aberto para fornecer instâncias descartáveis e leves de bancos de dados, message brokers, browsers ou praticamente qualquer coisa que possa ser executada em um container Docker.”\nAdicionando dependências: org.testcontainers mongodb 1.19.2 test org.testcontainers testcontainers 1.19.2 test org.testcontainers junit-jupiter 1.19.2 test A primeira dependência irá variar de acordo com suas necessidades, dependendo do que precisar subir, no meu caso, só o MongoDB, se precisasse de RabbitMQ, também o adicionaria, por exemplo.\nNo código, é simples, depois de termos as dependências configuradas corretamente, podemos adicionar e instanciar os containers passando a tag da imagem docker como parâmetro, para o mongodb, mongo:latest.\nAdicionar o Container: private static final MongoDBContainer MONGO_DB_CONTAINER = new MongoDBContainer(\"mongo:latest\"); Adicionar @Container à variável do container Se estiver usando Spring 3.1+, adicionar a anotação @ServiceConnection também. Essa configuração pega os dados do container criado e automaticamente sobrescreve com essas informações o container que seria usado originalmente Caso contrário, precisamos fazer isso na mão: crie um método que recebe como parâmetro DynamicPropertyRegistry Anote esse método com @DynamicPropertySource Altere as propriedades que estavam configuradas anteriormente usando registry.add(\"propriedade\", valor) @Container private static final MongoDBContainer MONGO_DB_CONTAINER = new MongoDBContainer(\"mongo:latest\"); @Container private static final RabbitMQContainer RABBIT_MQ_CONTAINER = new RabbitMQContainer(\"rabbitmq:management\"); @DynamicPropertySource static void mongoDbProperties(DynamicPropertyRegistry registry) { MONGO_DB_CONTAINER.start(); registry.add(\"spring.data.mongodb.uri\", MONGO_DB_CONTAINER::getReplicaSetUrl); registry.add(\"spring.rabbitmq.addresses\",() -\u003e \"amqp://guest:guest@localhost:\"+RABBIT_MQ_CONTAINER.getAmqpPort()); } A partir daí, siga sua vida com seu Rabbit, Mongo ou qualquer outra instância descartável.\n@Testcontainers @SpringBootTest public class TicketRepositoryJPATest { @Autowired private TicketRepositoryJPA ticketRepository; @Autowired private TicketFactory ticketFactory; @Container // @ServiceConnection spring 3.1+ - makes DynamicPropertySource unnecessary private static final MongoDBContainer MONGO_DB_CONTAINER = new MongoDBContainer(\"mongo:latest\"); @DynamicPropertySource static void mongoDbProperties(DynamicPropertyRegistry registry) { MONGO_DB_CONTAINER.start(); registry.add(\"spring.data.mongodb.uri\", MONGO_DB_CONTAINER::getReplicaSetUrl); } @Test @Order(0) void InsertTicket_Success(){ Ticket t = ticketFactory.createTicket(\"validemail@gmail.com\", \"I have a problem\", \"hellp\"); ticketRepository.insert(t); } @Test @Order(1) void FindAll_findsOne(){ var tickets = ticketRepository.findAll(); assertEquals(tickets.size(), 1); } } No caso acima faço um teste simples de repositório onde garanto que alguns métodos estão sendo executados corretamente, mas poderia por exemplo, fazer um teste de integração que garante service + repositório, ou até mesmo um teste de integração completo com TestRestTemplate.\nImportanto classes de declaração de Testcontainer Um padrão comum ao usar o Testcontainers é declarar instâncias de **Container**como campos estáticos. Frequentemente, esses campos são definidos diretamente na classe de teste. Eles também podem ser declarados em uma classe pai ou em uma interface que o teste implementa:\npublic interface MyContainers { @Container MongoDBContainer mongoContainer = new MongoDBContainer(\"mongo:5.0\"); @Container Neo4jContainer\u003c?\u003e neo4jContainer = new Neo4jContainer\u003c\u003e(\"neo4j:5\"); } Para mais discussões, não focando só no setup, mas em configurações diferentes, prós e contras, recomendo esse post: https://maciejwalkowiak.com/blog/testcontainers-spring-boot-setup/\nOutra ideia interessante é que podemos configurar TestContainers para aplicações rodando em desenvolvimento, vai servir como um docker compose que não precisamos rodar. É legal, mas não gosto muito da abordagem pois usar docker-compose se tornou parte comum dia a dia de muitos devs e possuí fácil leitura e troubleshooting. Se te animar, para explorar esse ponto: https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.testing.testcontainers.at-development-time\nReferências: https://spring.io/blog/2023/06/23/improved-testcontainers-support-in-spring-boot-3-1\nhttps://howtodoinjava.com/spring-boot/testcontainers-with-junit-and-spring-boot/\nhttps://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.testing.testcontainers\nTestes de Integração - TestRestTemplate TestRestTemplate TestRestTemplate is a convenience alternative to Spring’s RestTemplate that is useful in integration tests. You can get a vanilla template or one that sends Basic HTTP authentication (with a username and password). In either case, the template is fault tolerant. This means that it behaves in a test-friendly way by not throwing exceptions on 4xx and 5xx errors. Instead, such errors can be detected through the returned ResponseEntity and its status code.\nSpring Framework 5.0 provides a new WebTestClient that works for https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.testing.spring-boot-applications.spring-webflux-tests and both https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.testing.spring-boot-applications.with-running-server. It provides a fluent API for assertions, unlike TestRestTemplate. It is recommended, but not mandatory, to use the Apache HTTP Client (version 5.1 or better). If you have that on your classpath, the TestRestTemplate responds by configuring the client appropriately. If you do use Apache’s HTTP client, some additional test-friendly features are enabled:\nRedirects are not followed (so you can assert the response location). Cookies are ignored (so the template is stateless). TestRestTemplate can be instantiated directly in your integration tests, as shown in the following example:\nJavaKotlin\n`class MyTests {\nprivate final TestRestTemplate template = new TestRestTemplate(); @Test void testRequest() { ResponseEntity headers = this.template.getForEntity(\"https://myhost.example.com/example\", String.class); assertThat(headers.getHeaders().getLocation()).hasHost(\"other.example.com\"); } }`\nAlternatively, if you use the @SpringBootTest annotation with WebEnvironment.RANDOM_PORT or WebEnvironment.DEFINED_PORT, you can inject a fully configured TestRestTemplate and start using it. If necessary, additional customizations can be applied through the RestTemplateBuilder bean. Any URLs that do not specify a host and port automatically connect to the embedded server, as shown in the following example:\nimport org.junit.jupiter.api.Test; import java.time.Duration; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.test.context.SpringBootTest; import org.springframework.boot.test.context.SpringBootTest.WebEnvironment; import org.springframework.boot.test.context.TestConfiguration; import org.springframework.boot.test.web.client.TestRestTemplate; import org.springframework.boot.web.client.RestTemplateBuilder; import org.springframework.context.annotation.Bean; import org.springframework.http.HttpHeaders; import static org.assertj.core.api.Assertions.assertThat; @SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT) class MySpringBootTests { @Autowired private TestRestTemplate template; @Test void testRequest() { HttpHeaders headers = this.template.getForEntity(\"/example\", String.class).getHeaders(); assertThat(headers.getLocation()).hasHost(\"other.example.com\"); } @TestConfiguration(proxyBeanMethods = false) static class RestTemplateBuilderConfiguration { @Bean RestTemplateBuilder restTemplateBuilder() { return new RestTemplateBuilder().setConnectTimeout(Duration.ofSeconds(1)) .setReadTimeout(Duration.ofSeconds(1)); } } } Execução de testes: Use a ferramenta de linha de comando do Maven para executar seus testes. Execute o comando mvn test na raiz do seu projeto. O Maven compilará o código-fonte e as classes de teste, carregará o contexto do Spring Boot e executará os testes de unidade. Os resultados dos testes serão exibidos no console, indicando se os testes passaram ou falharam. Application-Test É normal usarmos variáveis de ambientes para a definição de diversos fatores da nossa aplicação, contudo, por isso é uma boa prática a criação de de uma estrutura de application properties (ou yaml) para testes dentro de src/test/resources\nExemplo:\nspring: autoconfigure: exclude: - org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration - org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration - org.springframework.cloud.openfeign.FeignAutoConfiguration - org.springframework.cloud.openfeign.hateoas.FeignHalAutoConfiguration - org.springframework.cloud.openfeign.loadbalancer.FeignLoadBalancerAutoConfiguration - org.springframework.cloud.openfeign.encoding.FeignAcceptGzipEncodingAutoConfiguration - org.springframework.cloud.openfeign.encoding.FeignContentGzipEncodingAutoConfiguration - org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration logging: level: org: springframework: web: client: RestTemplate: debug Organization: zendesk: country-to-instance: co: base-url: https://example.com/co user: co_zendesk_user api-token: co_zendesk_api_token ec: base-url: https://example.com/ec user: ec_zendesk_user password: ec_zendesk_password caffeine-cache: country-schedule-cache: refresh-after-write: PT1M countries: enabled: - co - ec - sa # invalid country - it will pass the entry point but will get stuck in any other country filtering point conversation: default-virtual-agent-profile: name: Test Agent Com essa classe criada, podemos passar no nosso SpringBootTest o profile que queremos utilizar.\n@Slf4j @SpringBootTest( webEnvironment = WebEnvironment.RANDOM_PORT, properties = \"spring.profiles.active=test\") Testes de Integração Caso possível, devemos usar o autowired para injetar as dependências. Se necessário, podemos mockar dependências com @MockBean\n@MockBean ChatInfoRepository repository; @Autowired ScheduleProperties scheduleProperties; Rest Assured ou cucumber ","wordCount":"2431","inLanguage":"pt","image":"https://kaue.cat/%3Cimage%20path/url%3E","datePublished":"2024-01-03T16:30:03Z","dateModified":"2024-01-03T16:30:03Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kaue.cat/posts/testes_java/"},"publisher":{"@type":"Organization","name":"Kaue Gatto","logo":{"@type":"ImageObject","url":"https://user-images.githubusercontent.com/25181517/192107856-aa92c8b1-b615-47c3-9141-ed0d29a90239.png"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kaue.cat accesskey=h title="Home (Alt + H)"><img src=https://kaue.cat/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://kaue.cat/en/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li><a href=https://kaue.cat/archives title=Arquivo><span>Arquivo</span></a></li><li><a href=https://kaue.cat/search/ title=Buscar><span>Buscar</span></a></li><li><a href=https://kaue.cat/series/ title=Séries><span>Séries</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kaue.cat>Início</a>&nbsp;»&nbsp;<a href=https://kaue.cat/posts/>Posts</a></div><h1 class=post-title>[WIP] Testes em Java - JUnit, Mockito, Integração e TestContainers</h1><div class=post-description>Vamos explorar como fazer testes em java!</div><div class=post-meta><span title='2024-01-03 16:30:03 +0000 UTC'>janeiro 3, 2024</span>&nbsp;·&nbsp;12 minutos&nbsp;·&nbsp;2431 palavras&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/kauegatto/kauedotcat/content/posts/testes_java.md rel="noopener noreferrer" target=_blank>Sugerir Alterações</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Conteúdo</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#assertions><strong>Assertions</strong></a></li><li><a href=#testes-parametrizados>Testes Parametrizados</a><ul><li><a href=#valuesource>@ValueSource</a></li><li><a href=#nullsource-emptysource><strong>@NullSource, @EmptySource</strong></a></li><li><a href=#methodsource>@MethodSource</a></li><li><a href=#csvsource><strong>@CsvSource</strong></a></li></ul></li></ul><ul><li><a href=#testcontainers>TestContainers</a><ul><li><a href=#importanto-classes-de-declaração-de-testcontainer>Importanto classes de declaração de Testcontainer</a></li></ul></li><li><a href=#referências>Referências:</a></li></ul><ul><li><ul><li><a href=#testresttemplate>TestRestTemplate</a></li></ul></li><li><a href=#application-test>Application-Test</a></li></ul></nav></div></details></div><div class=post-content><p>Aviso - Algumas imagens estarão quebradas aqui, enquanto for um trabalho em progresso, recomendo a leitura <a href="https://kauegatto.notion.site/WIP-Testes-c79bc9928c4d44d4979f59d127012e6c?pvs=4">aqui!</a></p><h1 id=spring--testing>Spring + Testing<a hidden class=anchor aria-hidden=true href=#spring--testing>#</a></h1><ol><li>Configuração do Maven:<ul><li>Certifique-se de que o Maven esteja instalado em seu sistema.</li><li>No arquivo <strong><code>pom.xml</code></strong> do seu projeto, adicione as dependências necessárias para JUnit e o suporte de testes do Spring Boot. Normalmente, essas dependências (normalmente <strong>spring-boot-starter-test)</strong> já estão incluídas no arquivo de modelo gerado pelo Spring Initializr ao criar um projeto Spring Boot.</li></ul></li><li>Estrutura de diretórios:<ul><li>No diretório do seu projeto, crie a estrutura de diretórios padrão para testes: <strong><code>src/test/java</code></strong> e <strong><code>src/test/resources</code></strong>.</li><li>Os testes de unidade devem ser colocados no diretório <strong><code>src/test/java</code></strong> seguindo a mesma estrutura de pacotes do código-fonte principal.</li></ul></li><li>Criação de testes:<ul><li><p>Crie classes de teste, essas classes de teste são geralmente nomeadas de acordo com a classe que estão testando, seguidas por &ldquo;Test&rdquo;. Exemplo: <strong><code>UserService</code></strong>, →**<code>UserServiceTest</code>**.</p></li><li><p>Anote a classe de teste com <strong><code>@RunWith(SpringRunner.class)</code></strong> para permitir a execução do teste no contexto do Spring Boot.</p></li><li><p>Anote a classe de teste com <strong><code>@SpringBootTest</code></strong> para carregar o contexto do Spring Boot durante a execução do teste.</p></li><li><p>Injete as dependências necessárias</p></li><li><p>Crie métodos de teste usando a anotação <strong><code>@Test</code></strong> e implemente a lógica de teste dentro desses métodos.</p><ul><li>Se esse teste lançar uma exceção, defina a propriedade expected na annotation.</li><li></li></ul></li></ul></li></ol><h1 id=junit---testes-de-unidade>JUnit - Testes de Unidade<a hidden class=anchor aria-hidden=true href=#junit---testes-de-unidade>#</a></h1><ul><li>Testes de unidade são testes feitos para cobrir um comportamento ou unidade específica de execução dentro de um método.<ul><li>Seu método de iniciar conversação pode ter vários e-se, nesse caso, um teste de unidade seria criado para validar cada e-se</li></ul></li><li>Testes de unidade, de maneira geral são executados com a biblioteca <code>JUnit</code>, que será o foco desse capítulo. Para sua utilização, criamos um método que retorna <code>void</code> e é anotado por <code>@Test</code>, esse método deve conter operações e validações (assertions) para garantir o retorno esperado.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.junit.Test</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>org.junit.Assert.assertEquals</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CalculadoraTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Test</span>
</span></span><span class=line><span class=cl>  <span class=nd>@DisplayName</span><span class=o>(</span><span class=s>&#34;Testando soma&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>testSoma</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	    <span class=c1>// Arrange (preparação)
</span></span></span><span class=line><span class=cl><span class=c1></span>	    <span class=n>Calculadora</span> <span class=n>calculadora</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Calculadora</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	    <span class=c1>// Act (ação)
</span></span></span><span class=line><span class=cl><span class=c1></span>	    <span class=kt>int</span> <span class=n>resultado</span> <span class=o>=</span> <span class=n>calculadora</span><span class=o>.</span><span class=na>soma</span><span class=o>(</span><span class=mi>2</span><span class=o>,</span> <span class=mi>3</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	    <span class=c1>// Assert (verificação)
</span></span></span><span class=line><span class=cl><span class=c1></span>	    <span class=n>assertEquals</span><span class=o>(</span><span class=mi>5</span><span class=o>,</span> <span class=n>resultado</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Test</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>testSubtracao</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	    <span class=c1>// Arrange
</span></span></span><span class=line><span class=cl><span class=c1></span>	    <span class=n>Calculadora</span> <span class=n>calculadora</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Calculadora</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	    <span class=c1>// Act
</span></span></span><span class=line><span class=cl><span class=c1></span>	    <span class=kt>int</span> <span class=n>resultado</span> <span class=o>=</span> <span class=n>calculadora</span><span class=o>.</span><span class=na>subtracao</span><span class=o>(</span><span class=mi>5</span><span class=o>,</span> <span class=mi>2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	    <span class=c1>// Assert
</span></span></span><span class=line><span class=cl><span class=c1></span>	    <span class=n>assertEquals</span><span class=o>(</span><span class=mi>3</span><span class=o>,</span> <span class=n>resultado</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Disabled</span><span class=o>(</span><span class=s>&#34;Esperando resolverem o bug que 3 é diferente de 1&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Test</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>testNaoSeiOq</span><span class=o>(){</span>
</span></span><span class=line><span class=cl>		  <span class=n>assertEquals</span><span class=o>(</span><span class=mi>3</span><span class=o>,</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><ul><li>Normalmente organizamos nossos testes de unidade em 3 etapas: given-when-then ou o triplo A: Arrange, Act & Assert</li></ul><h2 id=assertions><strong>Assertions</strong><a hidden class=anchor aria-hidden=true href=#assertions>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Padrão: 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>assertEquals</span><span class=o>(</span><span class=mi>2</span><span class=o>,</span> <span class=n>calculadora</span><span class=o>.</span><span class=na>soma</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>1</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=n>assertEquals</span><span class=o>(</span><span class=mi>4</span><span class=o>,</span> <span class=n>calculadora</span><span class=o>.</span><span class=na>multiplica</span><span class=o>(</span><span class=mi>2</span><span class=o>,</span> <span class=mi>2</span><span class=o>),</span> <span class=s>&#34;The optional failure message is now the last parameter&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>assertTrue</span><span class=o>(</span><span class=sc>&#39;a&#39;</span> <span class=o>&lt;</span> <span class=sc>&#39;b&#39;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=c1>// Exceptions
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Exception</span> <span class=n>exception</span> <span class=o>=</span> <span class=n>assertThrows</span><span class=o>(</span><span class=n>Aritmetica</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>calculadora</span><span class=o>.</span><span class=na>divide</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>0</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=n>assertEquals</span><span class=o>(</span><span class=s>&#34;/ por zero&#34;</span><span class=o>,</span> <span class=n>exception</span><span class=o>.</span><span class=na>getMessage</span><span class=o>());</span> <span class=c1>// opcional
</span></span></span></code></pre></div><p>Existem também bibliotecas focadas em gerar assertions mais legíveis/fluentes, como <code>AssertJ</code> e <code>Hamcrest</code>, podemos usa-las em conjunto com JUnit:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>org.assertj.core.api.Assertions.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=n>assertThat</span><span class=o>(</span><span class=n>frodo</span><span class=o>.</span><span class=na>getName</span><span class=o>()).</span><span class=na>isEqualTo</span><span class=o>(</span><span class=s>&#34;Frodo&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>assertThat</span><span class=o>(</span><span class=n>frodo</span><span class=o>).</span><span class=na>isNotEqualTo</span><span class=o>(</span><span class=n>sauron</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>assertThat</span><span class=o>(</span><span class=n>fellowshipOfTheRing</span><span class=o>).</span><span class=na>hasSize</span><span class=o>(</span><span class=mi>9</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                               <span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=n>frodo</span><span class=o>,</span> <span class=n>sam</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                               <span class=o>.</span><span class=na>doesNotContain</span><span class=o>(</span><span class=n>sauron</span><span class=o>);</span>
</span></span></code></pre></div><h2 id=testes-parametrizados>Testes Parametrizados<a hidden class=anchor aria-hidden=true href=#testes-parametrizados>#</a></h2><p>Testes parametrizados permitem a execução do “mesmo teste”, mas com inputs diferentes, com bem mais facilidade do que criar testes separados:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.junit.Test</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.junit.runner.RunWith</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.Arrays</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.Collection</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>org.junit.Assert.assertEquals</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CalculadoraTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@ParameterizedTest</span>
</span></span><span class=line><span class=cl>	  <span class=nd>@CsvSource</span><span class=o>({</span><span class=s>&#34;2, 3, 5&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>								<span class=s>&#34;5, 2, 3&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>								<span class=s>&#34;0, 0, 0&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>								<span class=s>&#34;-1, 1, 0&#34;</span><span class=o>})</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testSoma</span><span class=o>(</span><span class=kt>int</span> <span class=n>inputA</span><span class=o>,</span> <span class=kt>int</span> <span class=n>inputB</span><span class=o>,</span> <span class=kt>int</span> <span class=n>expectedResult</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>       <span class=c1>// Arrange
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Calculadora</span> <span class=n>calculadora</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Calculadora</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Act
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kt>int</span> <span class=n>resultado</span> <span class=o>=</span> <span class=n>calculadora</span><span class=o>.</span><span class=na>soma</span><span class=o>(</span><span class=n>inputA</span><span class=o>,</span> <span class=n>inputB</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Assert
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>assertEquals</span><span class=o>(</span><span class=n>expectedResult</span><span class=o>,</span> <span class=n>resultado</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Note que passamos os valores usando <code>@CsvSource</code>, mas não é a única maneira</p><h3 id=valuesource>@ValueSource<a hidden class=anchor aria-hidden=true href=#valuesource>#</a></h3><p>Uma das maneiras mais simples de realizar testes parametrizados no JUnit 5 é usando a anotação <strong><code>@ValueSource</code></strong>. Esta anotação permite especificar um único vetor de valores literais para fornecer argumentos a um método de teste parametrizado.</p><p>Os <strong>principais tipos</strong> são suportados**:** int, long, float, String, Class, etc:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>javaCopy</span> <span class=n>code</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.junit.jupiter.params.ParameterizedTest</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.junit.jupiter.params.provider.ValueSource</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>org.junit.jupiter.api.Assertions.assertTrue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ExemploTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@ParameterizedTest</span>
</span></span><span class=line><span class=cl>    <span class=nd>@ValueSource</span><span class=o>(</span><span class=n>ints</span> <span class=o>=</span> <span class=o>{</span><span class=mi>1</span><span class=o>,</span> <span class=mi>2</span><span class=o>,</span> <span class=mi>3</span><span class=o>})</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>testComValueSource</span><span class=o>(</span><span class=kt>int</span> <span class=n>argumento</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>assertTrue</span><span class=o>(</span><span class=n>argumento</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>argumento</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=nullsource-emptysource><strong>@NullSource, @EmptySource</strong><a hidden class=anchor aria-hidden=true href=#nullsource-emptysource>#</a></h3><p>Para testes de fronteira, ou input ruins pode ser útil passar valores nulos ou empty para nossos testes parametrizados:</p><ol><li><strong>@NullSource: F</strong>ornece um argumento nulo para o método de teste parametrizado anotado. <strong>Não pode ser usada para parâmetros que têm um tipo primitivo.</strong></li><li><strong>@EmptySource:</strong> Fornece um argumento vazio para o teste parametrizado. Ela pode ser utilizada para parâmetros de tipos como <strong><code>java.lang.String</code></strong>, <strong><code>java.util.Collection</code></strong>, <strong><code>java.util.List</code></strong>, <strong><code>java.util.Set</code></strong>, <strong><code>java.util.Map</code></strong>, e arrays primitivos e de objetos.</li><li><strong>@NullAndEmptySource:</strong>
Esta é uma anotação composta que combina as funcionalidades de <strong><code>@NullSource</code></strong> e <strong><code>@EmptySource</code></strong>.</li></ol><p>Se precisarmos fornecer vários tipos de strings em branco para um teste parametrizado, podemos usar <strong><code>@ValueSource</code></strong> da seguinte maneira:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@ValueSource</span><span class=o>(</span><span class=n>strings</span> <span class=o>=</span> <span class=o>{</span><span class=s>&#34; &#34;</span><span class=o>,</span> <span class=s>&#34;   &#34;</span><span class=o>,</span> <span class=s>&#34;\t&#34;</span><span class=o>,</span> <span class=s>&#34;\n&#34;</span><span class=o>})</span>
</span></span></code></pre></div><p>Podemos combinar <strong><code>@NullSource</code></strong>, <strong><code>@EmptySource</code></strong> e <strong><code>@ValueSource</code>:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@ParameterizedTest</span>
</span></span><span class=line><span class=cl><span class=nd>@NullAndEmptySource</span>
</span></span><span class=line><span class=cl><span class=nd>@ValueSource</span><span class=o>(</span><span class=n>strings</span> <span class=o>=</span> <span class=o>{</span><span class=s>&#34; &#34;</span><span class=o>,</span> <span class=s>&#34;   &#34;</span><span class=o>,</span> <span class=s>&#34;\t&#34;</span><span class=o>,</span> <span class=s>&#34;\n&#34;</span><span class=o>})</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>testNullEmptyAndBlankStrings</span><span class=o>(</span><span class=n>String</span> <span class=n>texto</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assertTrue</span><span class=o>(</span><span class=n>texto</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>texto</span><span class=o>.</span><span class=na>trim</span><span class=o>().</span><span class=na>isEmpty</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=methodsource>@MethodSource<a hidden class=anchor aria-hidden=true href=#methodsource>#</a></h3><p>A anotação <strong><code>@MethodSource</code></strong> permite referenciar métodos na própria classe de teste ou em classes externas. Esses métodos devem ser estáticos. Cada método deve gerar uma sequência de argumentos. No final das contas, teremos uma <code>Stream&lt;Arguments></code>, mas podemos enviar uma ArrayList, Arrays ou qualquer coisa que faça sentido e deixar o JUnit se virar 🙂.</p><p>Exemplo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@ParameterizedTest</span>
</span></span><span class=line><span class=cl><span class=nd>@MethodSource</span><span class=o>(</span><span class=s>&#34;stringProvider&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>testComMethodSource</span><span class=o>(</span><span class=n>String</span> <span class=n>argument</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assertNotNull</span><span class=o>(</span><span class=n>argument</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>static</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>stringProvider</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=s>&#34;apple&#34;</span><span class=o>,</span> <span class=s>&#34;banana&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Se um método parametrizado tiver diversos parâmtros, você precisará retornar uma collection, stream ou array de instâncias de <code>Arguments</code>, ou um arrays de objetos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@ParameterizedTest</span>
</span></span><span class=line><span class=cl><span class=nd>@MethodSource</span><span class=o>(</span><span class=s>&#34;stringIntAndListProvider&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>testWithMultiArgMethodSource</span><span class=o>(</span><span class=n>String</span> <span class=n>str</span><span class=o>,</span> <span class=kt>int</span> <span class=n>num</span><span class=o>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>list</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assertEquals</span><span class=o>(</span><span class=mi>5</span><span class=o>,</span> <span class=n>str</span><span class=o>.</span><span class=na>length</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=n>assertTrue</span><span class=o>(</span><span class=n>num</span> <span class=o>&gt;=</span><span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=n>num</span> <span class=o>&lt;=</span><span class=mi>2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>assertEquals</span><span class=o>(</span><span class=mi>2</span><span class=o>,</span> <span class=n>list</span><span class=o>.</span><span class=na>size</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>static</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>Arguments</span><span class=o>&gt;</span> <span class=nf>stringIntAndListProvider</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=n>arguments</span><span class=o>(</span><span class=s>&#34;apple&#34;</span><span class=o>,</span> <span class=mi>1</span><span class=o>,</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=s>&#34;a&#34;</span><span class=o>,</span> <span class=s>&#34;b&#34;</span><span class=o>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>arguments</span><span class=o>(</span><span class=s>&#34;lemon&#34;</span><span class=o>,</span> <span class=mi>2</span><span class=o>,</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=s>&#34;x&#34;</span><span class=o>,</span> <span class=s>&#34;y&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Podemos usar métodos estáticos de outras classes como <code>MethodSource</code> dessa forma:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@MethodSource</span><span class=o>(</span><span class=s>&#34;example.StringsProviders#tinyStrings&#34;</span><span class=o>)</span>
</span></span></code></pre></div><h3 id=csvsource><strong>@CsvSource</strong><a hidden class=anchor aria-hidden=true href=#csvsource>#</a></h3><p>A anotação <strong><code>@CsvSource</code></strong> permite expressar listas de argumentos como valores separados por vírgulas. Cada string fornecida representa um registro CSV e resulta em uma invocação do teste parametrizado.</p><p>O delimitador padrão é a vírgula, mas pode ser alterado.</p><p>As aspas simples são usadas como aspas reais, servem para indicar que aquilo dentro é um texto, mas isso também pode ser configurado.</p><table><thead><tr><th>Example Input</th><th>Resulting Argument List</th></tr></thead><tbody><tr><td>@CsvSource({ &ldquo;apple, banana&rdquo; })</td><td>&ldquo;apple&rdquo;, &ldquo;banana&rdquo;</td></tr><tr><td>@CsvSource({ &ldquo;apple, &rsquo;lemon, lime&rsquo;&rdquo; })</td><td>&ldquo;apple&rdquo;, &ldquo;lemon, lime&rdquo;</td></tr><tr><td>@CsvSource({ &ldquo;apple, &lsquo;&rsquo;&rdquo; })</td><td>&ldquo;apple&rdquo;, ""</td></tr><tr><td>@CsvSource({ &ldquo;apple, " })</td><td>&ldquo;apple&rdquo;, null</td></tr><tr><td>@CsvSource(value = { &ldquo;apple, banana, NIL&rdquo; }, nullValues = &ldquo;NIL&rdquo;)</td><td>&ldquo;apple&rdquo;, &ldquo;banana&rdquo;, null</td></tr><tr><td>@CsvSource(value = { " apple , banana&rdquo; }, ignoreLeadingAndTrailingWhitespace = false)</td><td>" apple &ldquo;, " banana&rdquo;</td></tr></tbody></table><p>Exemplo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@ParameterizedTest</span>
</span></span><span class=line><span class=cl><span class=nd>@CsvSource</span><span class=o>({</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;apple,         1&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;banana,        2&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;&#39;lemon, lime&#39;, 0xF1&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;strawberry,    700_000&#34;</span>
</span></span><span class=line><span class=cl><span class=o>})</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>testComCsvSource</span><span class=o>(</span><span class=n>String</span> <span class=n>fruit</span><span class=o>,</span> <span class=kt>int</span> <span class=n>rank</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assertNotNull</span><span class=o>(</span><span class=n>fruit</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>assertNotEquals</span><span class=o>(</span><span class=mi>0</span><span class=o>,</span> <span class=n>rank</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Talvez a magia do csv source, além da leitura, seja a possibilidade de implementar diversos testes via um arquivo csv localizado no sistema de arquivos local e/ou classpath</p><p><code>@CsvFileSource(resources = "/custom-csv.csv")</code></p><h1 id=mocking>Mocking<a hidden class=anchor aria-hidden=true href=#mocking>#</a></h1><p>Tanto em testes de integração quanto de unidade, percebemos que devemos travar alguns valores, ou seja, se estamos testando uma regra de negócio dentro de um service, gostaríamos que nosso repositório sempre estivesse correto, assumimos isso como verdade para que nosso teste de unidade seja realmente de unidade.</p><p>Não indo muito longe, é fácil criar mocks usando a biblioteca mockito:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>org.mockito.Mockito.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// (4.10+)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>List</span> <span class=n>mockedList</span> <span class=o>=</span> <span class=n>mock</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=c1>// em versões mais antigas: List mockedList = mock(List.class);
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Com um objeto mockado, não recebemos exceptions:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>mockedList</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;one&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>mockedList</span><span class=o>.</span><span class=na>clear</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Com um objeto mockado, sabemos tudo que aconteceu:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>verify</span><span class=o>(</span><span class=n>mockedList</span><span class=o>).</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;one&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>verify</span><span class=o>(</span><span class=n>mockedList</span><span class=o>).</span><span class=na>clear</span><span class=o>();</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.junit.jupiter.api.Test</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.mockito.InjectMocks</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.mockito.Mock</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.mockito.MockitoAnnotations</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>org.mockito.Mockito.when</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>UserServiceTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Mock</span>
</span></span><span class=line><span class=cl>    <span class=n>UserRepository</span> <span class=n>repository</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@InjectMocks</span>
</span></span><span class=line><span class=cl>    <span class=n>UserService</span> <span class=n>service</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@BeforeEach</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>setUp</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>MockitoAnnotations</span><span class=o>.</span><span class=na>initMocks</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>test</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>when</span><span class=o>(</span><span class=n>repository</span><span class=o>.</span><span class=na>findById</span><span class=o>(</span><span class=s>&#34;123&#34;</span><span class=o>)).</span><span class=na>thenReturn</span><span class=o>(</span><span class=k>new</span> <span class=n>User</span><span class=o>());</span> <span class=c1>// mockado :)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span></code></pre></div><ol><li><strong>Configurando Comportamento:</strong><ul><li>Utilize <strong><code>when()</code></strong> ou <strong><code>given()</code></strong> para especificar como o mock deve se comportar.</li><li>Se as respostas padrão não atenderem, implemente sua própria lógica estendendo a interface <strong><code>Answer</code></strong> e atribua ao mock.</li></ul></li><li><strong><code>spy()</code> e <code>@Spy</code>:</strong><ul><li>Utilize <strong><code>spy()</code></strong> para criar um spy, é quase que um mock parcial, que chama os métodos reais, mas ainda pode ser verificado e manipulado.</li></ul></li><li><strong><code>@InjectMocks</code>:</strong><ul><li>Anote a classe de teste com <strong><code>@InjectMocks</code></strong> para a injeção automática de mocks e spies anotados com <strong><code>@Mock</code></strong> ou <strong><code>@Spy</code></strong>.</li></ul></li><li><strong><code>verify()</code>:</strong><ul><li>Use <strong><code>verify()</code></strong> para verificar se os métodos foram chamados com os argumentos esperados.</li><li>Você pode ser mais flexível usando coisas como <strong><code>any()</code>.</strong></li></ul></li></ol><h1 id=testando-repositórios-de-verdade>Testando Repositórios (De verdade!)<a hidden class=anchor aria-hidden=true href=#testando-repositórios-de-verdade>#</a></h1><ul><li>Podemos testar repositórios de alguns jeitos, uma das maneiras é utilizar um banco em memória. Para SQL, h2 é fácil e rápido, podemos fazer as configs no banco usando um application-properties para os testes e validar tudo bonitinho normalmente 🙂. Outra alternativa seria utilizar TestContainers</li></ul><h2 id=testcontainers>TestContainers<a hidden class=anchor aria-hidden=true href=#testcontainers>#</a></h2><blockquote><p>&ldquo;Testcontainers é um framework de código aberto para fornecer instâncias descartáveis e leves de bancos de dados, message brokers, browsers ou praticamente qualquer coisa que possa ser executada em um container Docker.”</p></blockquote><ul><li>Adicionando dependências:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;groupId&gt;</span>org.testcontainers<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;artifactId&gt;</span>mongodb<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;version&gt;</span>1.19.2<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;groupId&gt;</span>org.testcontainers<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;artifactId&gt;</span>testcontainers<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;version&gt;</span>1.19.2<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;groupId&gt;</span>org.testcontainers<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;artifactId&gt;</span>junit-jupiter<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;version&gt;</span>1.19.2<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>A primeira dependência irá variar de acordo com suas necessidades, dependendo do que precisar subir, no meu caso, só o MongoDB, se precisasse de RabbitMQ, também o adicionaria, por exemplo.</p><p>No código, é simples, depois de termos as dependências configuradas corretamente, podemos adicionar e instanciar os containers passando a <code>tag</code> da imagem docker como parâmetro, para o mongodb, <code>mongo:latest</code>.</p><ol><li>Adicionar o Container: <code>private static final MongoDBContainer MONGO_DB_CONTAINER = new MongoDBContainer("mongo:latest");</code></li><li>Adicionar <code>@Container</code> à variável do container</li><li>Se estiver usando Spring 3.1+, adicionar a anotação <code>@ServiceConnection</code> também. Essa configuração pega os dados do container criado e automaticamente sobrescreve com essas informações o container que seria usado originalmente<ol><li>Caso contrário, precisamos fazer isso na mão: crie um método que recebe como parâmetro <code>DynamicPropertyRegistry</code></li><li>Anote esse método com <code>@DynamicPropertySource</code></li><li>Altere as propriedades que estavam configuradas anteriormente usando <code>registry.add("propriedade", valor)</code></li></ol></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Container</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>MongoDBContainer</span> <span class=n>MONGO_DB_CONTAINER</span> <span class=o>=</span> <span class=k>new</span> <span class=n>MongoDBContainer</span><span class=o>(</span><span class=s>&#34;mongo:latest&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=nd>@Container</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>RabbitMQContainer</span> <span class=n>RABBIT_MQ_CONTAINER</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RabbitMQContainer</span><span class=o>(</span><span class=s>&#34;rabbitmq:management&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=nd>@DynamicPropertySource</span>
</span></span><span class=line><span class=cl><span class=kd>static</span> <span class=kt>void</span> <span class=nf>mongoDbProperties</span><span class=o>(</span><span class=n>DynamicPropertyRegistry</span> <span class=n>registry</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>MONGO_DB_CONTAINER</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=n>registry</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;spring.data.mongodb.uri&#34;</span><span class=o>,</span> <span class=n>MONGO_DB_CONTAINER</span><span class=o>::</span><span class=n>getReplicaSetUrl</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=n>registry</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;spring.rabbitmq.addresses&#34;</span><span class=o>,()</span> <span class=o>-&gt;</span> <span class=s>&#34;amqp://guest:guest@localhost:&#34;</span><span class=o>+</span><span class=n>RABBIT_MQ_CONTAINER</span><span class=o>.</span><span class=na>getAmqpPort</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>A partir daí, siga sua vida com seu Rabbit, Mongo ou qualquer outra instância descartável.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Testcontainers</span>
</span></span><span class=line><span class=cl><span class=nd>@SpringBootTest</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>TicketRepositoryJPATest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=n>TicketRepositoryJPA</span> <span class=n>ticketRepository</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=n>TicketFactory</span> <span class=n>ticketFactory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Container</span>
</span></span><span class=line><span class=cl>  <span class=c1>// @ServiceConnection spring 3.1+ - makes DynamicPropertySource unnecessary
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>MongoDBContainer</span> <span class=n>MONGO_DB_CONTAINER</span> <span class=o>=</span> <span class=k>new</span> <span class=n>MongoDBContainer</span><span class=o>(</span><span class=s>&#34;mongo:latest&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=nd>@DynamicPropertySource</span>
</span></span><span class=line><span class=cl>  <span class=kd>static</span> <span class=kt>void</span> <span class=nf>mongoDbProperties</span><span class=o>(</span><span class=n>DynamicPropertyRegistry</span> <span class=n>registry</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>MONGO_DB_CONTAINER</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>registry</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;spring.data.mongodb.uri&#34;</span><span class=o>,</span> <span class=n>MONGO_DB_CONTAINER</span><span class=o>::</span><span class=n>getReplicaSetUrl</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>  <span class=nd>@Order</span><span class=o>(</span><span class=mi>0</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>InsertTicket_Success</span><span class=o>(){</span>
</span></span><span class=line><span class=cl>    <span class=n>Ticket</span> <span class=n>t</span> <span class=o>=</span> <span class=n>ticketFactory</span><span class=o>.</span><span class=na>createTicket</span><span class=o>(</span><span class=s>&#34;validemail@gmail.com&#34;</span><span class=o>,</span> <span class=s>&#34;I have a problem&#34;</span><span class=o>,</span> <span class=s>&#34;hellp&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>ticketRepository</span><span class=o>.</span><span class=na>insert</span><span class=o>(</span><span class=n>t</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>  <span class=nd>@Order</span><span class=o>(</span><span class=mi>1</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>FindAll_findsOne</span><span class=o>(){</span>
</span></span><span class=line><span class=cl>    <span class=n>var</span> <span class=n>tickets</span> <span class=o>=</span> <span class=n>ticketRepository</span><span class=o>.</span><span class=na>findAll</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>assertEquals</span><span class=o>(</span><span class=n>tickets</span><span class=o>.</span><span class=na>size</span><span class=o>(),</span> <span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>No caso acima faço um teste simples de repositório onde garanto que alguns métodos estão sendo executados corretamente, mas poderia por exemplo, fazer um teste de integração que garante service + repositório, ou até mesmo um teste de integração completo com <code>TestRestTemplate</code>.</p><h3 id=importanto-classes-de-declaração-de-testcontainer>Importanto classes de declaração de Testcontainer<a hidden class=anchor aria-hidden=true href=#importanto-classes-de-declaração-de-testcontainer>#</a></h3><p>Um padrão comum ao usar o Testcontainers é declarar instâncias de **<code>Container</code>**como campos estáticos. Frequentemente, esses campos são definidos diretamente na classe de teste. Eles também podem ser declarados em uma classe pai ou em uma interface que o teste implementa:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>MyContainers</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Container</span>
</span></span><span class=line><span class=cl>	<span class=n>MongoDBContainer</span> <span class=n>mongoContainer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>MongoDBContainer</span><span class=o>(</span><span class=s>&#34;mongo:5.0&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Container</span>
</span></span><span class=line><span class=cl>	<span class=n>Neo4jContainer</span><span class=o>&lt;?&gt;</span> <span class=n>neo4jContainer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Neo4jContainer</span><span class=o>&lt;&gt;(</span><span class=s>&#34;neo4j:5&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Para mais discussões, não focando só no setup, mas em configurações diferentes, prós e contras, recomendo esse post: <a href=https://maciejwalkowiak.com/blog/testcontainers-spring-boot-setup/>https://maciejwalkowiak.com/blog/testcontainers-spring-boot-setup/</a></p><p>Outra ideia interessante é que podemos configurar TestContainers para aplicações rodando em desenvolvimento, vai servir como um docker compose que não precisamos rodar. É legal, mas não gosto muito da abordagem pois usar docker-compose se tornou parte comum dia a dia de muitos devs e possuí fácil leitura e troubleshooting. Se te animar, para explorar esse ponto: <a href=https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.testing.testcontainers.at-development-time>https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.testing.testcontainers.at-development-time</a></p><h2 id=referências>Referências:<a hidden class=anchor aria-hidden=true href=#referências>#</a></h2><p><a href=https://spring.io/blog/2023/06/23/improved-testcontainers-support-in-spring-boot-3-1>https://spring.io/blog/2023/06/23/improved-testcontainers-support-in-spring-boot-3-1</a></p><p><a href=https://howtodoinjava.com/spring-boot/testcontainers-with-junit-and-spring-boot/>https://howtodoinjava.com/spring-boot/testcontainers-with-junit-and-spring-boot/</a></p><p><a href=https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.testing.testcontainers>https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.testing.testcontainers</a></p><h1 id=testes-de-integração---testresttemplate>Testes de Integração - TestRestTemplate<a hidden class=anchor aria-hidden=true href=#testes-de-integração---testresttemplate>#</a></h1><h3 id=testresttemplate>TestRestTemplate<a hidden class=anchor aria-hidden=true href=#testresttemplate>#</a></h3><p><code>TestRestTemplate</code> is a convenience alternative to Spring’s <code>RestTemplate</code> that is useful in integration tests. You can get a vanilla template or one that sends Basic HTTP authentication (with a username and password). In either case, the template is fault tolerant. This means that it behaves in a test-friendly way by not throwing exceptions on 4xx and 5xx errors. Instead, such errors can be detected through the returned <code>ResponseEntity</code> and its status code.</p><table><thead><tr><th></th><th>Spring Framework 5.0 provides a new WebTestClient that works for https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.testing.spring-boot-applications.spring-webflux-tests and both https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.testing.spring-boot-applications.with-running-server. It provides a fluent API for assertions, unlike TestRestTemplate.</th></tr></thead></table><p>It is recommended, but not mandatory, to use the Apache HTTP Client (version 5.1 or better). If you have that on your classpath, the <code>TestRestTemplate</code> responds by configuring the client appropriately. If you do use Apache’s HTTP client, some additional test-friendly features are enabled:</p><ul><li>Redirects are not followed (so you can assert the response location).</li><li>Cookies are ignored (so the template is stateless).</li></ul><p><code>TestRestTemplate</code> can be instantiated directly in your integration tests, as shown in the following example:</p><p><strong>JavaKotlin</strong></p><p>`class MyTests {</p><pre><code>private final TestRestTemplate template = new TestRestTemplate();

@Test
void testRequest() {
    ResponseEntity&lt;String&gt; headers = this.template.getForEntity(&quot;https://myhost.example.com/example&quot;, String.class);
    assertThat(headers.getHeaders().getLocation()).hasHost(&quot;other.example.com&quot;);
}
</code></pre><p>}`</p><p>Alternatively, if you use the <code>@SpringBootTest</code> annotation with <code>WebEnvironment.RANDOM_PORT</code> or <code>WebEnvironment.DEFINED_PORT</code>, you can inject a fully configured <code>TestRestTemplate</code> and start using it. If necessary, additional customizations can be applied through the <code>RestTemplateBuilder</code> bean. Any URLs that do not specify a host and port automatically connect to the embedded server, as shown in the following example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.junit.jupiter.api.Test</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.time.Duration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.beans.factory.annotation.Autowired</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.boot.test.context.SpringBootTest</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.boot.test.context.SpringBootTest.WebEnvironment</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.boot.test.context.TestConfiguration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.boot.test.web.client.TestRestTemplate</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.boot.web.client.RestTemplateBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Bean</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.http.HttpHeaders</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>org.assertj.core.api.Assertions.assertThat</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@SpringBootTest</span><span class=o>(</span><span class=n>webEnvironment</span> <span class=o>=</span> <span class=n>WebEnvironment</span><span class=o>.</span><span class=na>RANDOM_PORT</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>MySpringBootTests</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>TestRestTemplate</span> <span class=n>template</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>testRequest</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>HttpHeaders</span> <span class=n>headers</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>template</span><span class=o>.</span><span class=na>getForEntity</span><span class=o>(</span><span class=s>&#34;/example&#34;</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>).</span><span class=na>getHeaders</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>assertThat</span><span class=o>(</span><span class=n>headers</span><span class=o>.</span><span class=na>getLocation</span><span class=o>()).</span><span class=na>hasHost</span><span class=o>(</span><span class=s>&#34;other.example.com&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@TestConfiguration</span><span class=o>(</span><span class=n>proxyBeanMethods</span> <span class=o>=</span> <span class=kc>false</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kd>class</span> <span class=nc>RestTemplateBuilderConfiguration</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>        <span class=n>RestTemplateBuilder</span> <span class=nf>restTemplateBuilder</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>new</span> <span class=n>RestTemplateBuilder</span><span class=o>().</span><span class=na>setConnectTimeout</span><span class=o>(</span><span class=n>Duration</span><span class=o>.</span><span class=na>ofSeconds</span><span class=o>(</span><span class=mi>1</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>setReadTimeout</span><span class=o>(</span><span class=n>Duration</span><span class=o>.</span><span class=na>ofSeconds</span><span class=o>(</span><span class=mi>1</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><ol><li>Execução de testes:<ul><li>Use a ferramenta de linha de comando do Maven para executar seus testes. Execute o comando <strong><code>mvn test</code></strong> na raiz do seu projeto.</li><li>O Maven compilará o código-fonte e as classes de teste, carregará o contexto do Spring Boot e executará os testes de unidade.</li><li>Os resultados dos testes serão exibidos no console, indicando se os testes passaram ou falharam.</li></ul></li></ol><h2 id=application-test>Application-Test<a hidden class=anchor aria-hidden=true href=#application-test>#</a></h2><p>É normal usarmos variáveis de ambientes para a definição de diversos fatores da nossa aplicação, contudo, por isso é uma boa prática a criação de de uma estrutura de application properties (ou yaml) para testes dentro de <strong><code>src/test/resources</code></strong></p><p>Exemplo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>spring</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>autoconfigure</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>exclude</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>org.springframework.cloud.openfeign.FeignAutoConfiguration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>org.springframework.cloud.openfeign.hateoas.FeignHalAutoConfiguration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>org.springframework.cloud.openfeign.loadbalancer.FeignLoadBalancerAutoConfiguration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>org.springframework.cloud.openfeign.encoding.FeignAcceptGzipEncodingAutoConfiguration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>org.springframework.cloud.openfeign.encoding.FeignContentGzipEncodingAutoConfiguration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>level</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>org</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>springframework</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>web</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>client</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>RestTemplate</span><span class=p>:</span><span class=w> </span><span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>Organization</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zendesk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>country-to-instance</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>co</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>base-url</span><span class=p>:</span><span class=w> </span><span class=l>https://example.com/co</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=l>co_zendesk_user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>api-token</span><span class=p>:</span><span class=w> </span><span class=l>co_zendesk_api_token</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>base-url</span><span class=p>:</span><span class=w> </span><span class=l>https://example.com/ec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=l>ec_zendesk_user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>ec_zendesk_password</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>caffeine-cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>country-schedule-cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>refresh-after-write</span><span class=p>:</span><span class=w> </span><span class=l>PT1M</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>countries</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>co</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>sa</span><span class=w> </span><span class=c># invalid country - it will pass the entry point but will get stuck in any other country filtering point</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>conversation</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>default-virtual-agent-profile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Test Agent</span><span class=w>
</span></span></span></code></pre></div><p>Com essa classe criada, podemos passar no nosso SpringBootTest o profile que queremos utilizar.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=nd>@SpringBootTest</span><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=n>webEnvironment</span> <span class=o>=</span> <span class=n>WebEnvironment</span><span class=o>.</span><span class=na>RANDOM_PORT</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=n>properties</span> <span class=o>=</span> <span class=s>&#34;spring.profiles.active=test&#34;</span><span class=o>)</span>
</span></span></code></pre></div><h1 id=testes-de-integração>Testes de Integração<a hidden class=anchor aria-hidden=true href=#testes-de-integração>#</a></h1><p><img loading=lazy src=https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9a9c67d7-98cc-495e-bfb7-5994dbeb18da/Untitled.png alt=Untitled></p><p>Caso possível, devemos usar o autowired para injetar as dependências. Se necessário, podemos mockar dependências com @MockBean</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@MockBean</span> <span class=n>ChatInfoRepository</span> <span class=n>repository</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=nd>@Autowired</span> <span class=n>ScheduleProperties</span> <span class=n>scheduleProperties</span><span class=o>;</span>
</span></span></code></pre></div><h1 id=rest-assured-ou-cucumber>Rest Assured ou cucumber<a hidden class=anchor aria-hidden=true href=#rest-assured-ou-cucumber>#</a></h1></div><footer class=post-footer><ul class=post-tags><li><a href=https://kaue.cat/tags/java/>JAVA</a></li><li><a href=https://kaue.cat/tags/spring/>SPRING</a></li><li><a href=https://kaue.cat/tags/testes/>TESTES</a></li></ul><nav class=paginav><a class=prev href=https://kaue.cat/posts/database-replication/><span class=title>« Página Anterior</span><br><span>[WIP] Replicação de Banco de Dados</span></a>
<a class=next href=https://kaue.cat/posts/encapsulamento/><span class=title>Próxima Página »</span><br><span>Encapsulamento: O Básico que todo jr. precisa saber!</span></a></nav><div class=share-buttons><a>Compartilhar:</a><br><a target=_blank rel="noopener noreferrer" aria-label="share [WIP] Testes em Java - JUnit, Mockito, Integração e TestContainers on x" href="https://x.com/intent/tweet/?text=%5bWIP%5d%20Testes%20em%20Java%20-%20JUnit%2c%20Mockito%2c%20Integra%c3%a7%c3%a3o%20e%20TestContainers&url=https%3a%2f%2fkaue.cat%2fposts%2ftestes_java%2f&hashtags=JAVA%2cSPRING%2cTESTES"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [WIP] Testes em Java - JUnit, Mockito, Integração e TestContainers on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fkaue.cat%2fposts%2ftestes_java%2f&title=%5bWIP%5d%20Testes%20em%20Java%20-%20JUnit%2c%20Mockito%2c%20Integra%c3%a7%c3%a3o%20e%20TestContainers&summary=%5bWIP%5d%20Testes%20em%20Java%20-%20JUnit%2c%20Mockito%2c%20Integra%c3%a7%c3%a3o%20e%20TestContainers&source=https%3a%2f%2fkaue.cat%2fposts%2ftestes_java%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [WIP] Testes em Java - JUnit, Mockito, Integração e TestContainers on whatsapp" href="https://api.whatsapp.com/send?text=%5bWIP%5d%20Testes%20em%20Java%20-%20JUnit%2c%20Mockito%2c%20Integra%c3%a7%c3%a3o%20e%20TestContainers%20-%20https%3a%2f%2fkaue.cat%2fposts%2ftestes_java%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></div></footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//www-kaue-cat.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2024 <a href=https://kaue.cat>Kaue Gatto</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>