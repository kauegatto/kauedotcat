<!doctype html><html lang=pt dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Streams em JAVA: Tudo que voc√™ precisa saber | Kaue Gatto</title><meta name=keywords content="JAVA,STREAMS"><meta name=description content="Streams √© um dos conceitos mais temidos e fundamentais da linguagem JAVA, mas n√£o √© t√£o dif√≠cil quanto parece, e aprender vai deixar seu c√≥digo bem melhor, confira :)"><meta name=author content="Me"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://kaue.cat/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://kaue.cat/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://kaue.cat/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://kaue.cat/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://kaue.cat/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=pt href=https://kaue.cat/posts/streams/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Streams em JAVA: Tudo que voc√™ precisa saber"><meta property="og:description" content="Streams √© um dos conceitos mais temidos e fundamentais da linguagem JAVA, mas n√£o √© t√£o dif√≠cil quanto parece, e aprender vai deixar seu c√≥digo bem melhor, confira :)"><meta property="og:type" content="article"><meta property="og:url" content="https://kaue.cat/posts/streams/"><meta property="og:image" content="https://kaue.cat/%3Cimage%20path/url%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-12T16:30:03+00:00"><meta property="article:modified_time" content="2023-11-12T16:30:03+00:00"><meta property="og:site_name" content="Kaue Gatto"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kaue.cat/%3Cimage%20path/url%3E"><meta name=twitter:title content="Streams em JAVA: Tudo que voc√™ precisa saber"><meta name=twitter:description content="Streams √© um dos conceitos mais temidos e fundamentais da linguagem JAVA, mas n√£o √© t√£o dif√≠cil quanto parece, e aprender vai deixar seu c√≥digo bem melhor, confira :)"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://kaue.cat/posts/"},{"@type":"ListItem","position":3,"name":"Streams em JAVA: Tudo que voc√™ precisa saber","item":"https://kaue.cat/posts/streams/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Streams em JAVA: Tudo que voc√™ precisa saber","name":"Streams em JAVA: Tudo que voc√™ precisa saber","description":"Streams √© um dos conceitos mais temidos e fundamentais da linguagem JAVA, mas n√£o √© t√£o dif√≠cil quanto parece, e aprender vai deixar seu c√≥digo bem melhor, confira :)","keywords":["JAVA","STREAMS"],"articleBody":"Map, Filter, Reduce Vamos come√ßar com um exemplo?\n* Given a list of people * We need to compute the average of the age of those people * For the people older than 20 Nesse caso, √© meio claro, come√ßamos com um objeto pessoa, mas trabalharemos / transformaremos o dado de uma maneira que consigamos a idade (map). O map pega um objeto, e mapeia para outro, geralmente de tipo diferente Com isso, vamos filtrar o dado age, para que ele s√≥ compute a m√©dia de maiores de 20 anos. Isso √© um filter. O filter literalmente filtra os dados, n√£o os transforma (diferente de map) e decide se deve manter ou n√£o o dado. 2.1. Filters em c√≥digo recebem uma predicate como par√¢metro, ela representa uma fun√ß√£o que recebe um argumento e retorna um valor booleano. Por fim, vamos calcular a m√©dia desse dado, j√° transformado de pessoas e filtado para que a idade seja \u003e20. Essa opera√ß√£o avg √© o reduce, nesse caso, vamos pensar nela a princ√≠pio como uma agrega√ß√£o (tipo min,max,count, etc). Opera√ß√£o Comportamento Map Transforma o dado, mudando seu tipo. N√£o muda o n√∫mero de elementos. Filter N√£o transforma o dado, reduz (ou mant√©m igual) o n√∫mero de elementos Reduce Combina os elementos em um resultado √∫nico. √â uma opera√ß√£o terminal que produz um √∫nico valor com base em uma opera√ß√£o de redu√ß√£o, como soma, m√©dia ou m√°ximo. Por que usar Streams? List\u003cPerson\u003e people = ...; int sum = 0; int count = 0; for (Person person: people) { if (person.getAge() \u003e 20) { count++; sum += person.getAge(); } } double average = 0d; if(count \u003e 0) { average = sum / count; } No exemplo acima, temos um c√≥digo que descreve com detalhes o que deve ser feito para chegarmos em um resultado (o resultado do exemplo apresentado), e se mudarmos o algoritmo, precisamos mudar o c√≥digo, mesmo que o algoritmo seja o mesmo. N√£o necessariamente precisa ser assim, em SQL, por exemplo, escrever√≠amos:\nSelect AVG(age) from People Where People.age\u003e20 Note que no exemplo acima, descrevemos ao c√≥digo o que queremos que seja feito, as premissas, descrevemos o resultado, e n√£o como o resultado deve ser computado.\nCollection X Streams Tudo certo, se o c√≥digo faz parte de uma lista ou qualquer cole√ß√£o, podemos tentar implementar assim:\nList\u003cPerson\u003e people = ...; double average = people.map(person -\u003e person.getAge()) .filter(age ‚Äî \u003e age \u003e 20) .average(); ERRADO! A API de collections n√£o prov√™ esse tipo de opera√ß√µes, o c√≥digo acima n√£o compila üòÑ!\nMas por que a API de Collections e Streams s√£o separadas? Imagine que essas opera√ß√µes s√£o feitas em uma lista de 1.000.000 de pessoas! Portanto, ap√≥s o primeiro map, voc√™ teria uma Lista com 1.000.000 de inteiros de idade (porque o map n√£o reduziria o tamanho em si), acho que j√° deu para perceber que duplicar a collection vai ser altamente custoso para o processador e para a mem√≥ria\nMas como isso funciona? Quando usamos pessoas.stream(), retornamos uma Stream. Por defini√ß√£o, um objeto de stream n√£o carrega dados, √© gr√°tis cria-lo.\nA collection is an in-memory data structure to hold values and before we start using collection, all the values should have been populated. Whereas a java Stream is a data structure that is computed on-demand. Java Stream doesn‚Äôt store data, it operates on the source data structure (collection and array) and produce pipelined data that we can use and perform specific operations.\nhttps://www.digitalocean.com/community/tutorials/java-8-stream\nOpera√ß√µes Intermedi√°rias X Finais Streams atuam sobre cole√ß√µes para realizar map / filter / reduce, opera√ß√µes intermedi√°rias s√£o opera√ß√µes sobre streams que retornam streams ( Stream map() ‚Üí M√©todo de stream, retorna stream).\nOpera√ß√µes finais s√£o opera√ß√µes que retornam a cole√ß√£o de novo, depois do processamento / pipelining acabar toList() √© um exemplo\nE como ficaria o c√≥digo Aqui est√° um exemplo de como ficaria o c√≥digo.\nList\u003cPessoa\u003e pessoas = new ArrayList\u003c\u003e(); pessoas.stream() .map(...) .filter(...) .average(); Stream\u003cString\u003e personNames = personStream.map(Person::getName); Stream\u003cString\u003e emptyNames = personNames.filter( name -\u003e name.isEmpty()) Stream\u003cString\u003e notEmptyNames = personNames.filter( name -\u003e !name.isEmpty()) Esse c√≥digo quebrar√°, tendo em vista que estamos processando a mesma stream personNames duas vezes!\nStream\u003cString\u003e personNames = personStream.map(Person::getName); Stream\u003cInteger\u003e personAges = personStream.map(Person::getAge); Nesse caso, estamos aplicando o map para criar duas streams diferentes, n√£o quebrar√° o c√≥digo.\nStream\u003cString\u003e emptyNames = personStream.map(Person::getName).filter(name -\u003e name.isEmpty()); Stream\u003cString\u003e notEmptyNames = personStream.map(Person::getName).filter(name -\u003e !name.isEmpty()); Esse c√≥digo, processando duas streams diferentes tamb√©m funcionar√°\nPor favor, n√£o crie vari√°veis para trabalhar com streams, fiz por did√°tica\nFlatMapping Flatmapping funciona para lidar com rela√ß√µes 1:N\nExemplo: Cidades, onde temos v√°rias pessoas por cidade.\nSuponha que queremos pegar todas as pessoas, independente de suas cidades. Nesse caso, nos preocupamos com a entidade relacionada, n√£o com as cidades em si**. O flatmap faz isso, pega uma entidade Cidade e retorna para n√≥s uma Stream.**\nList\u003cCity\u003e cities = ...; Function\u003cCity, Stream\u003cPerson\u003e\u003e flatMapper = city -\u003e city.getPeople().stream(); long count = cities.stream() .flatMap(flatMapper) /*poder√≠amos colocar city -\u003e city.getPeople().stream() direto*/ .count() List\u003cString\u003e words \"Gomu\",\"Gomu\", \"No\", \"Mi\"); Stream\u003cString\u003e streamStream = words.stream() .map(w -\u003e w.split(\"\")) // Stream .flatMap(Arrays::stream) ; // Stream O flatmap funciona nesse caso, pois ao aplicar flatMap(Arrays::stream), voc√™ est√° dizendo ao Java para pegar cada array de caracteres da Stream e transform√°-lo em uma stream de strings (Stream) usando o m√©todo est√°tico Arrays.stream().\nStreams a partir de RegEx String sentence = \"the quick brown fox jumps over the lazy dog\"; String[] words = sentence. split( Stream\u003cString\u003e wordsStream = Arrays.stream(words); Ion count = wordsStream.count() Ao fazermos dessa forma, criamos um array intermedi√°rio, perdemos o prop√≥sito de streams.\nPodemos fazer:\nPattern pattern = Pattern.compile(\" \"); long count = pattern.sp1itAsStream(sentence) . count(); Streams de outro tipo Em java, existem interfaces de stream feitas para manipular certos primitivos mais adequadamente, um exemplo disso √© a IntStream\nIntStream IntStream tende a ser mais eficiente em termos de espa√ßo e desempenho quando voc√™ est√° trabalhando com valores inteiros primitivos, uma vez que evita a cria√ß√£o de objetos Integer.\nA IntStream oferece opera√ß√µes especializadas para trabalhar com valores inteiros, como sum(), average(), range(), rangeClosed(), etc. Uma Stream fornece opera√ß√µes de stream gen√©ricas aplic√°veis a objetos, mas √© menos eficiente quando se trata de c√°lculos com tipos primitivos.\nRefactoring ‚Üí Exemplo com m√∫ltiplas tarefas ao mesmo tempo Streams n√£o s√£o uma boa para realizarem m√∫ltiplas tarefas simultaneamente, portanto se temos um for loop que agrega valores √† 3 vari√°veis diferentes, precisamos dividir em 3 for‚Äôs (repetidos) e trocar cada um deles por uma stream. Claro, isso diminui muito a performance, mas em um for com poucos elementos a serem iterados, ser√° basicamente impercept√≠vel.\npublic String statement() { double totalAmount = rentals.stream() .mapToDoub1e(this::computeRenta1Amount) .sum(); int frequentRenterPoints = rentals.stream() .mapToInt (this::getFrequentRenterPoints) .sum(); String statement = composeHeader(); statement += rentals.stream() .map(this::computeStatementLine) .collect(Collectors.joining()); } Redu√ß√µes Antes, ouvimos que redu√ß√£o era algo similar a uma agrega√ß√£o do SQL, vamos continuar com isso em mente, mas como isso funciona?\nVamos ter como exemplo a soma, a soma √© uma uma implementa√ß√£o de BinaryOperator, que pega dois elementos e os soma ( sum = (i1,i2) -\u003e i1+i2;). Isso acontece com dois elementos por vez, associando os valores e depois somando com o outro.\nRedu√ß√µes de uma stream vazia Mas e qual a redu√ß√£o de uma Stream vazia? A redu√ß√£o de uma Stream vazia √© o seu elemento identidade (identity), um elemento identidade √© um valor pr√©-definido que atua como ponto de partida em uma opera√ß√£o de redu√ß√£o. Em contextos de programa√ß√£o funcional, quando n√£o h√° elementos para combinar na Stream, a opera√ß√£o de redu√ß√£o retorna o elemento identidade como resultado, garantindo que a opera√ß√£o seja definida e n√£o cause exce√ß√µes em casos de Stream vazia. Isso √© especialmente √∫til para lidar com casos em que n√£o h√° dados dispon√≠veis para a opera√ß√£o espec√≠fica, permitindo que o c√≥digo se comporte de maneira previs√≠vel e segura.\nPor exemplo, o identity de uma soma √© 0, tendo em vista que o 0 n√£o impactar√° no valor final, para m√∫ltiplica√ß√£o, um.\nMax, Min, Avg? O ‚Äúidentity element‚Äù ou valor inicial para as opera√ß√µes de max, min e average em Streams do Java √© um pouco diferente porque essas opera√ß√µes retornam um Optional, que pode ser vazio (caso a Stream esteja vazia) ou conter um valor, portanto, essas opera√ß√µes n√£o tem valores identity.\nPortanto, para acessar max, min e avg, voc√™ deve fazer algo do tipo:\nOptional\u003cInteger\u003e max = numbers.stream().max(Integer::compareTo); Optional\u003cInteger\u003e min = numbers.stream().min(Integer::compareTo); OptionalDouble average = numbers.stream().mapToDouble(Integer::doubleValue).average(); System.out.println(\"Max: \" + max.orElse(null)); System.out.println(\"Min: \" + min.orElse(null)); System.out.println(\"Average: \" + average.orElse(Double.NaN)); Como podemos escrever nossas reductions? Talvez voc√™ esteja se perguntando o porqu√™ de entendermos tamb√©m a fundamenta√ß√£o de identity elements, se ainda n√£o ficou claro, vai ficar agora:\nA opera√ß√£o reduce em Streams do Java tem dois par√¢metros principais:\nO valor inicial (identity element): J√° foi explicado Uma fun√ß√£o de acumula√ß√£o (accumulator function): Esta fun√ß√£o √© usada para combinar os elementos da Stream em um √∫nico resultado. A fun√ß√£o deve ser uma express√£o lambda ou um m√©todo de refer√™ncia que aceite dois argumentos e retorne um resultado. Em soma, seria (a, b) -\u003e a + b Se sua stream n√£o possuir um identity, voc√™ pode usar uma outra sobrecarga do m√©todo que n√£o recebe o identity, mas retorna um Optional. Use-o somente se n√£o possuir o identity‚Ä¶\nRedu√ß√µes em um container mut√°vel Redu√ß√µes em um container mut√°vel referem-se √† aplica√ß√£o de opera√ß√µes de redu√ß√£o, como soma, multiplica√ß√£o, m√©dia, entre outras, a elementos armazenados em um cont√™iner que pode ser alterado durante o processo de redu√ß√£o. Um ‚Äúcontainer‚Äù neste contexto pode ser definido como uma estrutura de dados flex√≠vel que permite armazenar e modificar elementos de forma din√¢mica (Lists, Maps, etc.). Portanto, podemos simplificar redu√ß√µes em containers mut√°veis como redu√ß√µes em cole√ß√µes.\nAo chamar .stream() em uma lista, voc√™ est√° criando uma Stream dos elementos contidos na lista. A Stream √© uma sequ√™ncia de elementos que pode ser processada de maneira funcional, mas n√£o modifica a lista original. Quando voc√™ chama .max(), por exemplo, est√° solicitando o elemento m√°ximo com base em algum crit√©rio da lista, mas a lista em si permanece a mesma.\nColetores! List\u003cPerson\u003e pessoasDaBaixada = new ArrayList() ; pessoasDaBaixada.stream() .filter(p -\u003e p.getDDD().equals(\"013\")) .forEach(p -\u003e pessoasDaBaixada.add(p)); Mas esse exemplo acima n√£o √© muito diferente do que j√° vimos, por que estamos focando nesse tipo de redu√ß√£o?\nPara filtrar e coletar elementos em uma nova lista usando a API de Streams do Java, voc√™ deve usar um coletor adequado, como Collectors.toList()\nOs coletores permitem que voc√™ capture os resultados das opera√ß√µes de redu√ß√£o em cole√ß√µes ou outros tipos de dados concretos. Em outras palavras, eles transformam os elementos processados em uma Stream em uma cole√ß√£o real que pode ser usada e manipulada posteriormente.\nList\u003cPerson\u003e pessoasDaBaixada = new ArrayList\u003c\u003e(); // Supondo que o n√∫mero de DDD seja uma String List\u003cPerson\u003e pessoasComDDD13 = pessoasDaBaixada.stream() .filter(p -\u003e \"13\".equals(p.getDDD())) .collect(Collectors.toList()); //.toList() retornar√° uma lista imut√°vel! ‚ÄùO novo m√©todo Stream.toList() n√£o produz nem uma lista n√£o modific√°vel nem √© um atalho para collect(toUnmodifiableList()), porque toUnmodifiableList() n√£o aceita valores nulos. A implementa√ß√£o de Stream.toList() n√£o √© limitada pela interface Collector; portanto, Stream.toList() aloca menos mem√≥ria. Isso a torna ideal para uso quando o tamanho da stream √© conhecida antecipadamente.‚Äù Link para coment√°rio no stackoverflow\nExemplos de Outros Coletores Collectors.toSet(): Cria um conjunto a partir dos elementos da Stream, removendo duplicatas. Collectors.toMap(keyMapper, valueMapper): Cria um map a partir dos elementos da Stream, usando fun√ß√µes de mapeamento para extrair chaves e valores. Collectors.groupingBy(classifier): Agrupa elementos da Stream com base em um crit√©rio definido pela fun√ß√£o de classifica√ß√£o. Collectors.joining(delimiter): Concatena os elementos da Stream em uma √∫nica String usando um delimitador. Collectors.summingInt() ou Collectors.summingLong(): Calcula a soma dos valores inteiros ou longos de elementos da Stream. Exemplos de uso: Map\u003cInteger, List\u003cPerson\u003e\u003e pessoasPorIdade = pessoas.stream() .collect(Collectors.groupingBy(Person::getIdade)); List\u003cPerson\u003e pessoas = Arrays.asList( new Person(\"Jorge\", 25), new Person(\"Ben\", 30), new Person(\"Jor\", 35) ); Map\u003cString, Integer\u003e mapNomeIdade = pessoas.stream() .collect(Collectors.toMap(Person::getNome, Person::getIdade)); // ex1 Map\u003cInteger, List\u003cPerson\u003e\u003e pessoasPorIdade = new HashMap\u003c\u003e(); pessoas.forEach(person -\u003e { Integer idade = person.getIdade(); List\u003cPerson\u003e pessoasComIdade = pessoasPorIdade.get(idade); if (pessoasComIdade == null) { pessoasComIdade = new ArrayList\u003c\u003e(); pessoasPorIdade.put(idade, pessoasComIdade); } pessoasComIdade.add(person); }); // ex2 Map\u003cString, Integer\u003e mapNomeIdade = new HashMap\u003c\u003e(); pessoas.stream().forEach(person -\u003e mapNomeIdade.put(person.getNome(), person.getIdade())); Pincelando: Streams Paralelas √Ä medida que exploramos as reductions e opera√ß√µes terminais, √© crucial considerar o potencial das streams paralelas em Java, mas o que s√£o? ü§î\nStreams paralelas oferecem a capacidade de executar opera√ß√µes em paralelo, aproveitando m√∫ltiplos n√∫cleos da CPU, o que melhora muito o desempenho da stream.\nApesar disso, vale dizer que opera√ß√µes em paralelo nem sempre podem ser consideradas em uma stream, suponha que voc√™ esteja calculando uma m√©dia com uma reduction, para calcularmos a m√©dia, precisamos primeiro somar os elementos, e ent√£o dividirmos, se somarmos e depois dividirmos partes distintas, isso trar√° um resultado incorreto, isso significa que a m√©dia √© uma opera√ß√£o n√£o associativa!\nOpera√ß√µes Associativas S√£o opera√ß√µes em que a ordem em que os elementos s√£o combinados n√£o afeta o resultado. Exemplos comuns de opera√ß√µes associativas incluem soma e multiplica√ß√£o.\nList\u003cInteger\u003e numbers = Arrays.asList(1, 2, 3, 4, 5); // C√°lculo da soma em uma stream paralela int sum = numbers.parallelStream().reduce(0, Integer::sum); Esse par√°grafo tem como objetivo apenas introduzir e notificar a exist√™ncia de streams paralelas, procure saber mais sobre elas! Opera√ß√µes N√£o-Associativas S√£o o oposto!\nConclus√£o e Agradecimento Obrigado pela leitura, espero que tenha sido produtiva e que voc√™ tenha todo o conhecimento necess√°rio para conseguir dar seus pr√≥prios passos e construir streams funcionais e avan√ßadas, caso necess√°rio.\nRefer√™ncias https://app.pluralsight.com/library/courses/692a1310-42db-4f3c-a33b-208a55b7bd84/table-of-contents\nhttps://www.digitalocean.com/community/tutorials/java-8-stream\nMaratona Java Virado no Jiraya\nhttps://acervolima.com/coletores-java/\n","wordCount":"2219","inLanguage":"pt","image":"https://kaue.cat/%3Cimage%20path/url%3E","datePublished":"2023-11-12T16:30:03Z","dateModified":"2023-11-12T16:30:03Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kaue.cat/posts/streams/"},"publisher":{"@type":"Organization","name":"Kaue Gatto","logo":{"@type":"ImageObject","url":"https://kaue.cat/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kaue.cat accesskey=h title="Home (Alt + H)"><img src=https://kaue.cat/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://kaue.cat/en/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li><a href=https://kaue.cat/archives title=Arquivo><span>Arquivo</span></a></li><li><a href=https://kaue.cat/search/ title=Buscar><span>Buscar</span></a></li><li><a href=https://kaue.cat/series/ title=S√©ries><span>S√©ries</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kaue.cat>In√≠cio</a>&nbsp;¬ª&nbsp;<a href=https://kaue.cat/posts/>Posts</a></div><h1 class=post-title>Streams em JAVA: Tudo que voc√™ precisa saber</h1><div class=post-description>Streams √© um dos conceitos mais temidos e fundamentais da linguagem JAVA, mas n√£o √© t√£o dif√≠cil quanto parece, e aprender vai deixar seu c√≥digo bem melhor, confira :)</div><div class=post-meta><span title='2023-11-12 16:30:03 +0000 UTC'>novembro 12, 2023</span>&nbsp;¬∑&nbsp;11 minutos&nbsp;¬∑&nbsp;2219 palavras&nbsp;¬∑&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/kauegatto/kauedotcat/content/posts/streams.md rel="noopener noreferrer" target=_blank>Sugerir Altera√ß√µes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Conte√∫do</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#map-filter-reduce>Map, Filter, Reduce</a></li><li><a href=#por-que-usar-streams>Por que usar Streams?</a></li><li><a href=#collection-x-streams>Collection X Streams</a><ul><li><a href=#mas-por-que-a-api-de-collections-e-streams-s√£o-separadas>Mas por que a API de Collections e Streams s√£o separadas?</a></li></ul></li><li><a href=#opera√ß√µes-intermedi√°rias-x-finais>Opera√ß√µes Intermedi√°rias X Finais</a></li><li><a href=#e-como-ficaria-o-c√≥digo>E como ficaria o c√≥digo</a></li><li><a href=#flatmapping>FlatMapping</a></li><li><a href=#streams-a-partir-de-regex>Streams a partir de RegEx</a></li><li><a href=#streams-de-outro-tipo>Streams de outro tipo</a><ul><li><a href=#intstream>IntStream</a></li></ul></li><li><a href=#refactoring--exemplo-com-m√∫ltiplas-tarefas-ao-mesmo-tempo>Refactoring ‚Üí Exemplo com m√∫ltiplas tarefas ao mesmo tempo</a></li><li><a href=#redu√ß√µes>Redu√ß√µes</a></li><li><a href=#redu√ß√µes-de-uma-stream-vazia>Redu√ß√µes de uma stream vazia</a><ul><li><a href=#max-min-avg>Max, Min, Avg?</a></li><li><a href=#como-podemos-escrever-nossas-reductions>Como podemos escrever nossas reductions?</a></li></ul></li><li><a href=#redu√ß√µes-em-um-container-mut√°vel>Redu√ß√µes em um container mut√°vel</a><ul><li><a href=#coletores>Coletores!</a></li><li><a href=#exemplos-de-outros-coletores><strong>Exemplos de Outros Coletores</strong></a></li><li><a href=#exemplos-de-uso>Exemplos de uso:</a></li></ul></li><li><a href=#pincelando-streams-paralelas>Pincelando: Streams Paralelas</a><ul><li><a href=#opera√ß√µes-associativas>Opera√ß√µes Associativas</a></li><li><a href=#opera√ß√µes-n√£o-associativas>Opera√ß√µes N√£o-Associativas</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=map-filter-reduce>Map, Filter, Reduce<a hidden class=anchor aria-hidden=true href=#map-filter-reduce>#</a></h2><p>Vamos come√ßar com um exemplo?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>*</span> <span class=n>Given</span> <span class=n>a</span> <span class=n>list</span> <span class=n>of</span> <span class=n>people</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>We</span> <span class=n>need</span> <span class=n>to</span> <span class=n>compute</span> <span class=n>the</span> <span class=n>average</span> <span class=n>of</span> <span class=n>the</span> <span class=n>age</span> <span class=n>of</span> <span class=n>those</span> <span class=n>people</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>For</span> <span class=n>the</span> <span class=n>people</span> <span class=n>older</span> <span class=n>than</span> <span class=mi>20</span>
</span></span></code></pre></div><ol><li>Nesse caso, √© meio claro, come√ßamos com um objeto pessoa, mas trabalharemos / transformaremos o dado de uma maneira que consigamos a idade (<strong>map</strong>). O map pega um objeto, e mapeia para outro, geralmente de tipo diferente</li></ol><p><img loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/q8t11tcox29jfu7dcw0x.png alt="Map, um objeto entra, √© transformado (seta) e sai outro"></p><ol start=2><li>Com isso, vamos filtrar o dado age, para que ele s√≥ compute a m√©dia de maiores de 20 anos. Isso √© um <strong>filter.</strong> O filter literalmente filtra os dados, n√£o os transforma (diferente de map) e decide se deve manter ou n√£o o dado.
2.1. Filters em c√≥digo recebem uma predicate como par√¢metro, ela representa uma fun√ß√£o que recebe um argumento e retorna um valor booleano.</li></ol><p><img loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ycioms5b7brys8h07bz1.png alt="Filter, entra idade, passa pelo filter (seta) e voltam apenas idades &amp;gt;20 "></p><ol start=3><li>Por fim, vamos calcular a m√©dia desse dado, j√° transformado de pessoas e filtado para que a idade seja >20. Essa opera√ß√£o avg √© o reduce, nesse caso, vamos pensar nela a princ√≠pio como uma agrega√ß√£o (tipo min,max,count, etc).</li></ol><p><img loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6tifjl5kvz87iiogbxzv.png alt="Image description"></p><table><thead><tr><th>Opera√ß√£o</th><th>Comportamento</th></tr></thead><tbody><tr><td>Map</td><td>Transforma o dado, mudando seu tipo. N√£o muda o n√∫mero de elementos.</td></tr><tr><td>Filter</td><td>N√£o transforma o dado, reduz (ou mant√©m igual) o n√∫mero de elementos</td></tr><tr><td>Reduce</td><td>Combina os elementos em um resultado √∫nico. √â uma opera√ß√£o terminal que produz um √∫nico valor com base em uma opera√ß√£o de redu√ß√£o, como soma, m√©dia ou m√°ximo.</td></tr></tbody></table><h2 id=por-que-usar-streams>Por que usar Streams?<a hidden class=anchor aria-hidden=true href=#por-que-usar-streams>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>Person</span><span class=o>&gt;</span> <span class=n>people</span> <span class=o>=</span> <span class=o>...;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>sum</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=o>(</span><span class=n>Person</span> <span class=n>person</span><span class=o>:</span> <span class=n>people</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=o>(</span><span class=n>person</span><span class=o>.</span><span class=na>getAge</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>20</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>count</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>		<span class=n>sum</span> <span class=o>+=</span> <span class=n>person</span><span class=o>.</span><span class=na>getAge</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=kt>double</span> <span class=n>average</span> <span class=o>=</span> <span class=mf>0d</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=o>(</span><span class=n>count</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=n>average</span> <span class=o>=</span> <span class=n>sum</span> <span class=o>/</span> <span class=n>count</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>No exemplo acima, temos um c√≥digo que <strong>descreve com detalhes o que deve ser feito para chegarmos em um resultado</strong> (o resultado do exemplo apresentado), e se mudarmos o algoritmo, precisamos mudar o c√≥digo, mesmo que o algoritmo seja o mesmo. N√£o necessariamente precisa ser assim, em SQL, por exemplo, escrever√≠amos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>Select</span><span class=w> </span><span class=k>AVG</span><span class=p>(</span><span class=n>age</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>People</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>Where</span><span class=w> </span><span class=n>People</span><span class=p>.</span><span class=n>age</span><span class=o>&gt;</span><span class=mi>20</span><span class=w>
</span></span></span></code></pre></div><p><strong>Note que no exemplo acima, descrevemos ao c√≥digo o que queremos que seja feito, as premissas, descrevemos o resultado, e n√£o como o resultado deve ser computado.</strong></p><h2 id=collection-x-streams>Collection X Streams<a hidden class=anchor aria-hidden=true href=#collection-x-streams>#</a></h2><p>Tudo certo, se o c√≥digo faz parte de uma lista ou qualquer cole√ß√£o, podemos tentar implementar assim:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>Person</span><span class=o>&gt;</span> <span class=n>people</span> <span class=o>=</span> <span class=o>...;</span>
</span></span><span class=line><span class=cl><span class=kt>double</span> <span class=n>average</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl><span class=n>people</span><span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>person</span> <span class=o>-&gt;</span> <span class=n>person</span><span class=o>.</span><span class=na>getAge</span><span class=o>())</span>
</span></span><span class=line><span class=cl>	<span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>age</span> <span class=err>‚Äî</span> <span class=o>&gt;</span> <span class=n>age</span> <span class=o>&gt;</span> <span class=mi>20</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=o>.</span><span class=na>average</span><span class=o>();</span>
</span></span></code></pre></div><p><strong>ERRADO!</strong> A API de collections n√£o prov√™ esse tipo de opera√ß√µes, o c√≥digo acima n√£o compila üòÑ!</p><h3 id=mas-por-que-a-api-de-collections-e-streams-s√£o-separadas>Mas por que a API de Collections e Streams s√£o separadas?<a hidden class=anchor aria-hidden=true href=#mas-por-que-a-api-de-collections-e-streams-s√£o-separadas>#</a></h3><p>Imagine que essas opera√ß√µes s√£o feitas em uma lista de 1.000.000 de pessoas! Portanto, ap√≥s o primeiro map, voc√™ teria uma Lista com 1.000.000 de inteiros de idade (porque o map n√£o reduziria o tamanho em si), acho que j√° deu para perceber que duplicar a collection vai ser altamente custoso para o processador e para a mem√≥ria</p><p>Mas como isso funciona? Quando usamos <code>pessoas.stream()</code>, retornamos uma <code>Stream&lt;Pessoa></code>. Por defini√ß√£o, um objeto de stream n√£o carrega dados, √© gr√°tis cria-lo.</p><blockquote><p>A collection is an in-memory data structure to hold values and before we start using collection, all the values should have been populated. Whereas a java Stream is a data structure that is computed on-demand. Java Stream doesn‚Äôt store data, it operates on the source data structure (collection and array) and produce pipelined data that we can use and perform specific operations.</p></blockquote><p><a href=https://www.digitalocean.com/community/tutorials/java-8-stream>https://www.digitalocean.com/community/tutorials/java-8-stream</a></p><blockquote></blockquote><h2 id=opera√ß√µes-intermedi√°rias-x-finais>Opera√ß√µes Intermedi√°rias X Finais<a hidden class=anchor aria-hidden=true href=#opera√ß√µes-intermedi√°rias-x-finais>#</a></h2><p>Streams atuam sobre cole√ß√µes para realizar map / filter / reduce, opera√ß√µes intermedi√°rias s√£o opera√ß√µes sobre streams que retornam streams ( <code>Stream&lt;T> map()</code> ‚Üí M√©todo de stream, retorna stream).</p><p>Opera√ß√µes finais s√£o opera√ß√µes que retornam a cole√ß√£o de novo, depois do processamento / pipelining acabar <code>toList()</code> √© um exemplo</p><h2 id=e-como-ficaria-o-c√≥digo>E como ficaria o c√≥digo<a hidden class=anchor aria-hidden=true href=#e-como-ficaria-o-c√≥digo>#</a></h2><p>Aqui est√° um exemplo de como ficaria o c√≥digo.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>Pessoa</span><span class=o>&gt;</span> <span class=n>pessoas</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>pessoas</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>				 <span class=o>.</span><span class=na>map</span><span class=o>(...)</span>
</span></span><span class=line><span class=cl>				 <span class=o>.</span><span class=na>filter</span><span class=o>(...)</span>
</span></span><span class=line><span class=cl>				 <span class=o>.</span><span class=na>average</span><span class=o>();</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>personNames</span> <span class=o>=</span> <span class=n>personStream</span><span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>Person</span><span class=o>::</span><span class=n>getName</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>emptyNames</span> <span class=o>=</span> <span class=n>personNames</span><span class=o>.</span><span class=na>filter</span><span class=o>(</span> <span class=n>name</span> <span class=o>-&gt;</span> <span class=n>name</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>())</span>
</span></span><span class=line><span class=cl><span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>notEmptyNames</span> <span class=o>=</span> <span class=n>personNames</span><span class=o>.</span><span class=na>filter</span><span class=o>(</span> <span class=n>name</span> <span class=o>-&gt;</span> <span class=o>!</span><span class=n>name</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>())</span>
</span></span></code></pre></div><p>Esse c√≥digo quebrar√°, tendo em vista que estamos processando a mesma stream personNames duas vezes!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>personNames</span> <span class=o>=</span> <span class=n>personStream</span><span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>Person</span><span class=o>::</span><span class=n>getName</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>Stream</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>personAges</span> <span class=o>=</span> <span class=n>personStream</span><span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>Person</span><span class=o>::</span><span class=n>getAge</span><span class=o>);</span>
</span></span></code></pre></div><p>Nesse caso, estamos aplicando o map para criar duas streams diferentes, n√£o quebrar√° o c√≥digo.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>emptyNames</span> <span class=o>=</span> <span class=n>personStream</span><span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>Person</span><span class=o>::</span><span class=n>getName</span><span class=o>).</span><span class=na>filter</span><span class=o>(</span><span class=n>name</span> <span class=o>-&gt;</span> <span class=n>name</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>notEmptyNames</span> <span class=o>=</span> <span class=n>personStream</span><span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>Person</span><span class=o>::</span><span class=n>getName</span><span class=o>).</span><span class=na>filter</span><span class=o>(</span><span class=n>name</span> <span class=o>-&gt;</span> <span class=o>!</span><span class=n>name</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>());</span>
</span></span></code></pre></div><p>Esse c√≥digo, processando duas streams diferentes tamb√©m funcionar√°</p><p>Por favor, n√£o crie vari√°veis para trabalhar com streams, fiz por did√°tica</p><h2 id=flatmapping>FlatMapping<a hidden class=anchor aria-hidden=true href=#flatmapping>#</a></h2><p>Flatmapping funciona para lidar com rela√ß√µes 1:N</p><p>Exemplo: Cidades, onde temos v√°rias pessoas por cidade.</p><p><img loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/z2j5fpkzolyphphn5t1y.png alt="Image description"></p><p>Suponha que queremos pegar todas as pessoas, independente de suas cidades. Nesse caso, nos preocupamos com a entidade relacionada, n√£o com as cidades em si**. O flatmap faz isso, pega uma entidade Cidade e retorna para n√≥s uma <code>Stream&lt;Pessoas></code>.**</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>City</span><span class=o>&gt;</span> <span class=n>cities</span> <span class=o>=</span> <span class=o>...;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Function</span><span class=o>&lt;</span><span class=n>City</span><span class=o>,</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>Person</span><span class=o>&gt;&gt;</span> <span class=n>flatMapper</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl>	<span class=n>city</span> <span class=o>-&gt;</span> <span class=n>city</span><span class=o>.</span><span class=na>getPeople</span><span class=o>().</span><span class=na>stream</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>long</span> <span class=n>count</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl>	<span class=n>cities</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>	<span class=o>.</span><span class=na>flatMap</span><span class=o>(</span><span class=n>flatMapper</span><span class=o>)</span> <span class=cm>/*poder√≠amos colocar city -&gt; city.getPeople().stream() direto*/</span>
</span></span><span class=line><span class=cl>	<span class=o>.</span><span class=na>count</span><span class=o>()</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>words</span> <span class=s>&#34;Gomu&#34;</span><span class=o>,</span><span class=s>&#34;Gomu&#34;</span><span class=o>,</span> <span class=s>&#34;No&#34;</span><span class=o>,</span> <span class=s>&#34;Mi&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>streamStream</span> <span class=o>=</span>
</span></span><span class=line><span class=cl><span class=n>words</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>w</span> <span class=o>-&gt;</span> <span class=n>w</span><span class=o>.</span><span class=na>split</span><span class=o>(</span><span class=s>&#34;&#34;</span><span class=o>))</span> <span class=c1>// Stream&lt;String[]&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>.</span><span class=na>flatMap</span><span class=o>(</span><span class=n>Arrays</span><span class=o>::</span><span class=n>stream</span><span class=o>)</span> <span class=o>;</span> <span class=c1>// Stream&lt;String&gt;
</span></span></span></code></pre></div><p>O flatmap funciona nesse caso, pois ao aplicar <strong><code>flatMap(Arrays::stream)</code></strong>, voc√™ est√° dizendo ao Java para pegar cada array de caracteres da <strong><code>Stream&lt;String[]></code></strong> e transform√°-lo em uma stream de strings (<strong><code>Stream&lt;String></code></strong>) usando o m√©todo est√°tico <strong><code>Arrays.stream()</code></strong>.</p><h2 id=streams-a-partir-de-regex>Streams a partir de RegEx<a hidden class=anchor aria-hidden=true href=#streams-a-partir-de-regex>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span> <span class=n>sentence</span> <span class=o>=</span> <span class=s>&#34;the quick brown fox jumps over the lazy dog&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=n>String</span><span class=o>[]</span> <span class=n>words</span> <span class=o>=</span> <span class=n>sentence</span><span class=o>.</span> <span class=nf>split</span><span class=o>(</span>
</span></span><span class=line><span class=cl><span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>wordsStream</span> <span class=o>=</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=n>words</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>Ion</span> <span class=n>count</span> <span class=o>=</span> <span class=n>wordsStream</span><span class=o>.</span><span class=na>count</span><span class=o>()</span>
</span></span></code></pre></div><p>Ao fazermos dessa forma, criamos um array intermedi√°rio, perdemos o prop√≥sito de streams.</p><p>Podemos fazer:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Pattern</span> <span class=n>pattern</span> <span class=o>=</span> <span class=n>Pattern</span><span class=o>.</span><span class=na>compile</span><span class=o>(</span><span class=s>&#34; &#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=kt>long</span> <span class=n>count</span> <span class=o>=</span> <span class=n>pattern</span><span class=o>.</span><span class=na>sp1itAsStream</span><span class=o>(</span><span class=n>sentence</span><span class=o>)</span> <span class=o>.</span> <span class=n>count</span><span class=o>();</span>
</span></span></code></pre></div><h2 id=streams-de-outro-tipo>Streams de outro tipo<a hidden class=anchor aria-hidden=true href=#streams-de-outro-tipo>#</a></h2><p>Em java, existem interfaces de stream feitas para manipular certos primitivos mais adequadamente, um exemplo disso √© a <code>IntStream</code></p><h3 id=intstream>IntStream<a hidden class=anchor aria-hidden=true href=#intstream>#</a></h3><p><strong><code>IntStream</code></strong> tende a ser mais eficiente em termos de espa√ßo e desempenho quando voc√™ est√° trabalhando com valores inteiros primitivos, uma vez que evita a cria√ß√£o de objetos <strong><code>Integer</code></strong>.</p><p>A <strong><code>IntStream</code></strong> oferece opera√ß√µes especializadas para trabalhar com valores inteiros, como <strong><code>sum()</code></strong>, <strong><code>average()</code></strong>, <strong><code>range()</code></strong>, <strong><code>rangeClosed()</code></strong>, etc. Uma <strong><code>Stream&lt;Integer></code></strong> fornece opera√ß√µes de stream <strong>gen√©ricas</strong> aplic√°veis a <strong>objetos</strong>, mas √© menos eficiente quando se trata de c√°lculos com tipos primitivos.</p><h2 id=refactoring--exemplo-com-m√∫ltiplas-tarefas-ao-mesmo-tempo>Refactoring ‚Üí Exemplo com m√∫ltiplas tarefas ao mesmo tempo<a hidden class=anchor aria-hidden=true href=#refactoring--exemplo-com-m√∫ltiplas-tarefas-ao-mesmo-tempo>#</a></h2><p>Streams n√£o s√£o uma boa para realizarem m√∫ltiplas tarefas simultaneamente, portanto se temos um for loop que agrega valores √† 3 vari√°veis diferentes, precisamos dividir em 3 for‚Äôs (repetidos) e trocar cada um deles por uma stream. Claro, isso diminui muito a performance, mas em um for com poucos elementos a serem iterados, ser√° basicamente impercept√≠vel.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>String</span> <span class=nf>statement</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kt>double</span> <span class=n>totalAmount</span> <span class=o>=</span> <span class=n>rentals</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>mapToDoub1e</span><span class=o>(</span><span class=k>this</span><span class=o>::</span><span class=n>computeRenta1Amount</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>sum</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>frequentRenterPoints</span> <span class=o>=</span> <span class=n>rentals</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>	<span class=o>.</span><span class=na>mapToInt</span> <span class=o>(</span><span class=k>this</span><span class=o>::</span><span class=n>getFrequentRenterPoints</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=o>.</span><span class=na>sum</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>String</span> <span class=n>statement</span> <span class=o>=</span> <span class=n>composeHeader</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>statement</span> <span class=o>+=</span> <span class=n>rentals</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>	<span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=k>this</span><span class=o>::</span><span class=n>computeStatementLine</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>Collectors</span><span class=o>.</span><span class=na>joining</span><span class=o>());</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=redu√ß√µes>Redu√ß√µes<a hidden class=anchor aria-hidden=true href=#redu√ß√µes>#</a></h2><p>Antes, ouvimos que redu√ß√£o era algo similar a uma agrega√ß√£o do SQL, vamos continuar com isso em mente, mas como isso funciona?</p><p>Vamos ter como exemplo a soma, a soma √© uma uma implementa√ß√£o de <code>BinaryOperator&lt;Integer></code>, que pega dois elementos e os soma ( <code>sum = (i1,i2) -> i1+i2;</code>). Isso acontece com dois elementos por vez, associando os valores e depois somando com o outro.</p><h2 id=redu√ß√µes-de-uma-stream-vazia>Redu√ß√µes de uma stream vazia<a hidden class=anchor aria-hidden=true href=#redu√ß√µes-de-uma-stream-vazia>#</a></h2><p><strong>Mas e qual a redu√ß√£o de uma Stream vazia?</strong> A <strong>redu√ß√£o de uma Stream vazia √© o seu elemento identidade (identity),</strong> um elemento identidade √© um valor pr√©-definido que atua como ponto de partida em uma opera√ß√£o de redu√ß√£o. Em contextos de programa√ß√£o funcional, quando n√£o h√° elementos para combinar na Stream, a opera√ß√£o de redu√ß√£o retorna o elemento identidade como resultado, garantindo que a opera√ß√£o seja definida e n√£o cause exce√ß√µes em casos de Stream vazia. Isso √© especialmente √∫til para lidar com casos em que n√£o h√° dados dispon√≠veis para a opera√ß√£o espec√≠fica, permitindo que o c√≥digo se comporte de maneira previs√≠vel e segura.</p><p>Por exemplo, o identity de uma soma √© 0, tendo em vista que o 0 n√£o impactar√° no valor final, para m√∫ltiplica√ß√£o, um.</p><h3 id=max-min-avg>Max, Min, Avg?<a hidden class=anchor aria-hidden=true href=#max-min-avg>#</a></h3><p>O &ldquo;identity element&rdquo; ou valor inicial para as opera√ß√µes de <strong><code>max</code></strong>, <strong><code>min</code></strong> e <strong><code>average</code></strong> em Streams do Java √© um pouco diferente porque essas opera√ß√µes retornam um <strong><code>Optional</code></strong>, que pode ser vazio (caso a Stream esteja vazia) ou conter um valor, portanto, essas opera√ß√µes n√£o tem valores identity.</p><p>Portanto, para acessar max, min e avg, voc√™ deve fazer algo do tipo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>max</span> <span class=o>=</span> <span class=n>numbers</span><span class=o>.</span><span class=na>stream</span><span class=o>().</span><span class=na>max</span><span class=o>(</span><span class=n>Integer</span><span class=o>::</span><span class=n>compareTo</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>min</span> <span class=o>=</span> <span class=n>numbers</span><span class=o>.</span><span class=na>stream</span><span class=o>().</span><span class=na>min</span><span class=o>(</span><span class=n>Integer</span><span class=o>::</span><span class=n>compareTo</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>OptionalDouble</span> <span class=n>average</span> <span class=o>=</span> <span class=n>numbers</span><span class=o>.</span><span class=na>stream</span><span class=o>().</span><span class=na>mapToDouble</span><span class=o>(</span><span class=n>Integer</span><span class=o>::</span><span class=n>doubleValue</span><span class=o>).</span><span class=na>average</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Max: &#34;</span> <span class=o>+</span> <span class=n>max</span><span class=o>.</span><span class=na>orElse</span><span class=o>(</span><span class=kc>null</span><span class=o>));</span>
</span></span><span class=line><span class=cl>	<span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Min: &#34;</span> <span class=o>+</span> <span class=n>min</span><span class=o>.</span><span class=na>orElse</span><span class=o>(</span><span class=kc>null</span><span class=o>));</span>
</span></span><span class=line><span class=cl>	<span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Average: &#34;</span> <span class=o>+</span> <span class=n>average</span><span class=o>.</span><span class=na>orElse</span><span class=o>(</span><span class=n>Double</span><span class=o>.</span><span class=na>NaN</span><span class=o>));</span>
</span></span></code></pre></div><h3 id=como-podemos-escrever-nossas-reductions>Como podemos escrever nossas reductions?<a hidden class=anchor aria-hidden=true href=#como-podemos-escrever-nossas-reductions>#</a></h3><p>Talvez voc√™ esteja se perguntando o porqu√™ de entendermos tamb√©m a fundamenta√ß√£o de identity elements, se ainda n√£o ficou claro, vai ficar agora:</p><p>A opera√ß√£o <strong><code>reduce</code></strong> em Streams do Java tem dois par√¢metros principais:</p><ol><li>O valor inicial (identity element): J√° foi explicado</li><li>Uma fun√ß√£o de acumula√ß√£o (accumulator function): Esta fun√ß√£o √© usada para combinar os elementos da Stream em um √∫nico resultado. A fun√ß√£o deve ser uma express√£o lambda ou um m√©todo de refer√™ncia que aceite dois argumentos e retorne um resultado. Em soma, seria
<code>(a, b) -> a + b</code></li></ol><p>Se sua stream n√£o possuir um identity, voc√™ pode usar uma outra sobrecarga do m√©todo que n√£o recebe o identity, mas retorna um Optional. Use-o somente se n√£o possuir o identity‚Ä¶</p><h2 id=redu√ß√µes-em-um-container-mut√°vel>Redu√ß√µes em um container mut√°vel<a hidden class=anchor aria-hidden=true href=#redu√ß√µes-em-um-container-mut√°vel>#</a></h2><p>Redu√ß√µes em um container mut√°vel referem-se √† aplica√ß√£o de opera√ß√µes de redu√ß√£o, como soma, multiplica√ß√£o, m√©dia, entre outras, a elementos armazenados em um cont√™iner que pode ser alterado durante o processo de redu√ß√£o. Um &ldquo;container&rdquo; neste contexto pode ser definido como uma estrutura de dados flex√≠vel que permite armazenar e modificar elementos de forma din√¢mica (Lists, Maps, etc.). Portanto, podemos simplificar redu√ß√µes em containers mut√°veis como redu√ß√µes em cole√ß√µes.</p><p>Ao chamar <strong><code>.stream()</code></strong> em uma lista, voc√™ est√° criando uma Stream dos elementos contidos na lista. A Stream √© uma sequ√™ncia de elementos que pode ser processada de maneira funcional, <strong>mas n√£o modifica a lista original.</strong> Quando voc√™ chama <strong><code>.max()</code></strong>, por exemplo, est√° solicitando o elemento m√°ximo com base em algum crit√©rio da lista, mas a lista em si permanece a mesma.</p><h3 id=coletores>Coletores!<a hidden class=anchor aria-hidden=true href=#coletores>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>Person</span><span class=o>&gt;</span> <span class=n>pessoasDaBaixada</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>()</span> <span class=o>;</span>
</span></span><span class=line><span class=cl><span class=n>pessoasDaBaixada</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>p</span> <span class=o>-&gt;</span> <span class=n>p</span><span class=o>.</span><span class=na>getDDD</span><span class=o>().</span><span class=na>equals</span><span class=o>(</span><span class=s>&#34;013&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl><span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>p</span> <span class=o>-&gt;</span> <span class=n>pessoasDaBaixada</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>p</span><span class=o>));</span>
</span></span></code></pre></div><p>Mas esse exemplo acima n√£o √© muito diferente do que j√° vimos, por que estamos focando nesse tipo de redu√ß√£o?</p><p>Para filtrar e coletar elementos em uma nova lista usando a API de Streams do Java, voc√™ deve usar um <strong>coletor</strong> adequado, como <strong><code>Collectors.toList()</code></strong></p><p>Os coletores permitem que voc√™ capture os resultados das opera√ß√µes de redu√ß√£o em cole√ß√µes ou outros tipos de dados concretos. <strong>Em outras palavras, eles transformam os elementos processados em uma Stream em uma cole√ß√£o real que pode ser usada e manipulada posteriormente.</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>Person</span><span class=o>&gt;</span> <span class=n>pessoasDaBaixada</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Supondo que o n√∫mero de DDD seja uma String
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Person</span><span class=o>&gt;</span> <span class=n>pessoasComDDD13</span> <span class=o>=</span> <span class=n>pessoasDaBaixada</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>p</span> <span class=o>-&gt;</span> <span class=s>&#34;13&#34;</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>p</span><span class=o>.</span><span class=na>getDDD</span><span class=o>()))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>Collectors</span><span class=o>.</span><span class=na>toList</span><span class=o>());</span>
</span></span><span class=line><span class=cl>	<span class=c1>//.toList() retornar√° uma lista imut√°vel!
</span></span></span></code></pre></div><blockquote><p><em>‚ÄùO novo m√©todo Stream.toList() n√£o produz nem uma lista n√£o modific√°vel nem √© um atalho para <code>collect(toUnmodifiableList())</code>, porque <code>toUnmodifiableList()</code> <strong>n√£o aceita valores nulos</strong>. A implementa√ß√£o de Stream.toList() n√£o √© limitada pela interface <code>Collector</code>; portanto, <code>Stream.toList()</code> aloca menos mem√≥ria. Isso a torna ideal para uso quando o tamanho da stream √© conhecida antecipadamente.‚Äù</em> <a href=https://stackoverflow.com/questions/65969919/differences-of-java-16s-stream-tolist-and-stream-collectcollectors-tolist#comment121174778_65991907>Link para coment√°rio no stackoverflow</a></p></blockquote><h3 id=exemplos-de-outros-coletores><strong>Exemplos de Outros Coletores</strong><a hidden class=anchor aria-hidden=true href=#exemplos-de-outros-coletores>#</a></h3><ul><li><strong><code>Collectors.toSet()</code></strong>: Cria um conjunto a partir dos elementos da Stream, removendo duplicatas.</li><li><strong><code>Collectors.toMap(keyMapper, valueMapper)</code></strong>: Cria um map a partir dos elementos da Stream, usando fun√ß√µes de mapeamento para extrair chaves e valores.</li><li><strong><code>Collectors.groupingBy(classifier)</code></strong>: Agrupa elementos da Stream com base em um crit√©rio definido pela fun√ß√£o de classifica√ß√£o.</li><li><strong><code>Collectors.joining(delimiter)</code></strong>: Concatena os elementos da Stream em uma √∫nica String usando um delimitador.</li><li><strong><code>Collectors.summingInt()</code></strong> ou <strong><code>Collectors.summingLong()</code></strong>: Calcula a soma dos valores inteiros ou longos de elementos da Stream.</li></ul><h3 id=exemplos-de-uso>Exemplos de uso:<a hidden class=anchor aria-hidden=true href=#exemplos-de-uso>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Map</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Person</span><span class=o>&gt;&gt;</span> <span class=n>pessoasPorIdade</span> <span class=o>=</span> <span class=n>pessoas</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>Collectors</span><span class=o>.</span><span class=na>groupingBy</span><span class=o>(</span><span class=n>Person</span><span class=o>::</span><span class=n>getIdade</span><span class=o>));</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>Person</span><span class=o>&gt;</span> <span class=n>pessoas</span> <span class=o>=</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>Person</span><span class=o>(</span><span class=s>&#34;Jorge&#34;</span><span class=o>,</span> <span class=mi>25</span><span class=o>),</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>Person</span><span class=o>(</span><span class=s>&#34;Ben&#34;</span><span class=o>,</span> <span class=mi>30</span><span class=o>),</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>Person</span><span class=o>(</span><span class=s>&#34;Jor&#34;</span><span class=o>,</span> <span class=mi>35</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span> <span class=n>mapNomeIdade</span> <span class=o>=</span> <span class=n>pessoas</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>Collectors</span><span class=o>.</span><span class=na>toMap</span><span class=o>(</span><span class=n>Person</span><span class=o>::</span><span class=n>getNome</span><span class=o>,</span> <span class=n>Person</span><span class=o>::</span><span class=n>getIdade</span><span class=o>));</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ex1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Map</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Person</span><span class=o>&gt;&gt;</span> <span class=n>pessoasPorIdade</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl><span class=n>pessoas</span><span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>person</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Integer</span> <span class=n>idade</span> <span class=o>=</span> <span class=n>person</span><span class=o>.</span><span class=na>getIdade</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=o>&lt;</span><span class=n>Person</span><span class=o>&gt;</span> <span class=n>pessoasComIdade</span> <span class=o>=</span> <span class=n>pessoasPorIdade</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>idade</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>pessoasComIdade</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>pessoasComIdade</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=n>pessoasPorIdade</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>idade</span><span class=o>,</span> <span class=n>pessoasComIdade</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=n>pessoasComIdade</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>person</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ex2
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span> <span class=n>mapNomeIdade</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl><span class=n>pessoas</span><span class=o>.</span><span class=na>stream</span><span class=o>().</span><span class=na>forEach</span><span class=o>(</span><span class=n>person</span> <span class=o>-&gt;</span> <span class=n>mapNomeIdade</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>person</span><span class=o>.</span><span class=na>getNome</span><span class=o>(),</span> <span class=n>person</span><span class=o>.</span><span class=na>getIdade</span><span class=o>()));</span>
</span></span></code></pre></div><h2 id=pincelando-streams-paralelas>Pincelando: Streams Paralelas<a hidden class=anchor aria-hidden=true href=#pincelando-streams-paralelas>#</a></h2><p>√Ä medida que exploramos as reductions e opera√ß√µes terminais, √© crucial considerar o potencial das streams paralelas em Java, mas o que s√£o? ü§î</p><p>Streams paralelas oferecem a capacidade de executar opera√ß√µes em paralelo, aproveitando m√∫ltiplos n√∫cleos da CPU, o que melhora muito o desempenho da stream.</p><p>Apesar disso, vale dizer que opera√ß√µes em paralelo nem sempre podem ser consideradas em uma stream, suponha que voc√™ esteja calculando uma m√©dia com uma reduction, para calcularmos a m√©dia, precisamos primeiro somar os elementos, e ent√£o dividirmos, se somarmos e depois dividirmos partes distintas, isso trar√° um <strong>resultado incorreto, isso significa que a m√©dia √© uma opera√ß√£o n√£o associativa!</strong></p><h3 id=opera√ß√µes-associativas>Opera√ß√µes Associativas<a hidden class=anchor aria-hidden=true href=#opera√ß√µes-associativas>#</a></h3><p>S√£o opera√ß√µes em que a ordem em que os elementos s√£o combinados n√£o afeta o resultado. Exemplos comuns de opera√ß√µes associativas incluem soma e multiplica√ß√£o.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>numbers</span> <span class=o>=</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>2</span><span class=o>,</span> <span class=mi>3</span><span class=o>,</span> <span class=mi>4</span><span class=o>,</span> <span class=mi>5</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=c1>// C√°lculo da soma em uma stream paralela
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>sum</span> <span class=o>=</span> <span class=n>numbers</span><span class=o>.</span><span class=na>parallelStream</span><span class=o>().</span><span class=na>reduce</span><span class=o>(</span><span class=mi>0</span><span class=o>,</span> <span class=n>Integer</span><span class=o>::</span><span class=n>sum</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>Esse</span> <span class=n>par</span><span class=err>√°</span><span class=n>grafo</span> <span class=n>tem</span> <span class=n>como</span> <span class=n>objetivo</span> <span class=n>apenas</span> <span class=n>introduzir</span> <span class=n>e</span> <span class=n>notificar</span> <span class=n>a</span> <span class=n>exist</span><span class=err>√™</span><span class=n>ncia</span> <span class=n>de</span> <span class=n>streams</span> <span class=n>paralelas</span><span class=o>,</span> <span class=n>procure</span> <span class=n>saber</span> <span class=n>mais</span> <span class=n>sobre</span> <span class=n>elas</span><span class=o>!</span>
</span></span></code></pre></div><h3 id=opera√ß√µes-n√£o-associativas>Opera√ß√µes N√£o-Associativas<a hidden class=anchor aria-hidden=true href=#opera√ß√µes-n√£o-associativas>#</a></h3><p>S√£o o oposto!</p><h1 id=conclus√£o-e-agradecimento>Conclus√£o e Agradecimento<a hidden class=anchor aria-hidden=true href=#conclus√£o-e-agradecimento>#</a></h1><p>Obrigado pela leitura, espero que tenha sido produtiva e que voc√™ tenha todo o conhecimento necess√°rio para conseguir dar seus pr√≥prios passos e construir streams funcionais e avan√ßadas, caso necess√°rio.</p><h1 id=refer√™ncias>Refer√™ncias<a hidden class=anchor aria-hidden=true href=#refer√™ncias>#</a></h1><p><a href=https://app.pluralsight.com/library/courses/692a1310-42db-4f3c-a33b-208a55b7bd84/table-of-contents>https://app.pluralsight.com/library/courses/692a1310-42db-4f3c-a33b-208a55b7bd84/table-of-contents</a></p><p><a href=https://www.digitalocean.com/community/tutorials/java-8-stream>https://www.digitalocean.com/community/tutorials/java-8-stream</a></p><p><a href="https://www.youtube.com/playlist?list=PL62G310vn6nFIsOCC0H-C2infYgwm8SWW">Maratona Java Virado no Jiraya</a></p><p><a href=https://acervolima.com/coletores-java/>https://acervolima.com/coletores-java/</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://kaue.cat/tags/java/>JAVA</a></li><li><a href=https://kaue.cat/tags/streams/>STREAMS</a></li></ul><nav class=paginav><a class=prev href=https://kaue.cat/posts/java_rabbitmq_parte1/><span class=title>¬´ P√°gina Anterior</span><br><span>RabbitMQ com Java e Spring : Come√ßando (pt. 1)</span></a>
<a class=next href=https://kaue.cat/posts/integracao_testcontainers/><span class=title>Pr√≥xima P√°gina ¬ª</span><br><span>TestContainers em Java: Testes de integra√ß√£o, reposit√≥rios e outras coisas!</span></a></nav><div class=share-buttons><a>Compartilhar:</a><br><a target=_blank rel="noopener noreferrer" aria-label="share Streams em JAVA: Tudo que voc√™ precisa saber on x" href="https://x.com/intent/tweet/?text=Streams%20em%20JAVA%3a%20Tudo%20que%20voc%c3%aa%20precisa%20saber&url=https%3a%2f%2fkaue.cat%2fposts%2fstreams%2f&hashtags=JAVA%2cSTREAMS"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Streams em JAVA: Tudo que voc√™ precisa saber on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fkaue.cat%2fposts%2fstreams%2f&title=Streams%20em%20JAVA%3a%20Tudo%20que%20voc%c3%aa%20precisa%20saber&summary=Streams%20em%20JAVA%3a%20Tudo%20que%20voc%c3%aa%20precisa%20saber&source=https%3a%2f%2fkaue.cat%2fposts%2fstreams%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Streams em JAVA: Tudo que voc√™ precisa saber on whatsapp" href="https://api.whatsapp.com/send?text=Streams%20em%20JAVA%3a%20Tudo%20que%20voc%c3%aa%20precisa%20saber%20-%20https%3a%2f%2fkaue.cat%2fposts%2fstreams%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></div></footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//www-kaue-cat.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2023 <a href=https://kaue.cat>Kaue Gatto</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>